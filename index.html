<!doctype html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="GISerDaiShaoqing's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="GISerDaiShaoqing's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GISerDaiShaoqing's Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> GISerDaiShaoqing's Blog </title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">GISerDaiShaoqing's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Urban·Ecology·GIS</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocapitalize="off" autocomplete="off" autocorrect="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/10/应用统计学与R语言实现学习笔记后记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dai Shaoqing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GISerDaiShaoqing's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/10/应用统计学与R语言实现学习笔记后记/" itemprop="url">
                  应用统计学与R语言实现学习笔记后记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-10T00:00:00+08:00">
                2017-10-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/统计与模型/" itemprop="url" rel="index">
                    <span itemprop="name">统计与模型</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/10/10/应用统计学与R语言实现学习笔记后记/" class="leancloud_visitors" data-flag-title="应用统计学与R语言实现学习笔记后记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-后记"><a href="#1-后记" class="headerlink" title="1 后记"></a>1 后记</h1><p>应用统计学与R语言实现学习笔记这一系列博客断断续续写了5个月左右。现在终于算是基本完成了。我个人比较强迫症，比较喜欢一个系列更完再更其他的。所以中间有一些不错的内容想写到博客里都没动笔。后面会继续填坑。另外之后遇到的跟应用统计学与R语言实现相关的内容会以番外篇形式发布。</p>
<p>当时想到写这个东西，主要是自己选了门应用统计学的公选课，个人觉得不能浪费了这门课，而且其实我们在做一些研究的时候，其实都用了很多新的、高大上的所谓的新方法，并且不断在追逐所谓的Big data，但是回过头来想想，最基础的统计学理论可能才是我们需要补课的地方（不得不说这门课挺对我胃口，去年暑假花了一部分时间在啃贾俊平的统计学，刚好是这门课的参考教材）。这个年代，用个tensorflow的包，import一下，训练个模型出来就能说自己做的是深度学习。个人意见，也对也不对。IT技术飞速发展，大大降低了程序猿的门槛，但是现在的情况更应当说是程序猿的行当易学难精了。扯得有点远，总之我认为返璞归真地去学一学高数、概率论、统计学、线性代数可能比一上来就开始各种机器学习什么的要强得多。</p>
<p>这份笔记的定位，就是一份笔记，某些程度上就是课程老师给我们的ppt，我对理论部分做了整理。所以要归功于我的任课老师王老师。我不求大家从头到尾看完这份笔记，因为理论很枯燥，但是当需要用些什么内容的时候，可以想起这份笔记，供大家查找和参考。我的笔记并不像《深入浅出统计学》那样直白而又易懂的语言，尽管中间有一定的尝试，所以不可能看完我的这个系列博客就能对统计学的基本内容完全融会贯通，如果你希望在统计学上有所建树，需要大家自己去补课。另外我这部分更多针对于应用，而且基于我自己本身地学背景，我讲的例子也都跟尽量跟地学、生态相关。所以其他专业的同学会觉得一些例子苦涩难懂是比较正常的（在此向其他专业同学说声不好意思，你们的批评我虚心接受，但是你们这方面的建议我坚决不改，傲娇脸）。</p>
<p>好，讲了这么多。这个系列我其实是作为我自己的一个开源项目做的，我希望大家有什么意见可以一起来帮忙修改完善这个项目。如果你觉得还不错，也不要吝啬你的star。我博客里提到的很多代码之类的也都在这个项目里面开源了。就请大家批评指正。</p>
<p><a href="https://github.com/GISerDaiShaoqing/Note-of-Applied-Statistics-with-R" target="_blank" rel="external">Note-of-Applied-Statistics-with-R</a></p>
<h1 id="2-基于gitbook的电子书生成教程"><a href="#2-基于gitbook的电子书生成教程" class="headerlink" title="2 基于gitbook的电子书生成教程"></a>2 基于gitbook的电子书生成教程</h1><blockquote>
<p>Modern book format and toolchain using Git and Markdown</p>
</blockquote>
<p>这是 gitbook 项目主页上对 gitbook 的定义。<br>gitbook 首先是一个软件，正如上面定义的那样，它使用 Git 和 Markdown 来编排书本。</p>
<blockquote>
<p><a href="https://www.gitbook.com" target="_blank" rel="external">gitbook官网</a></p>
</blockquote>
<p>也可以使用gitbook editor。<br>gitbook可以与github关联，直接将仓库的markdown文档发布成电子书。为了方便管理，选择在github上搭建电子书整体内容，然后push到github上，同时同步到gitbook中。首先用github登录gitbook。接着在github上创建一个新的仓库。只保留markdown文档和文件夹。gitbook的关键是需要SUMMARY的markdown文档，这个文件是用来组织书的框架。如下图。</p>
<p><img src="http://img.blog.csdn.net/20171010102953719?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>README的前言其实就是上面的后记，想说的话大体相同。只不过时间先后问题导致成了前言和后记。其他的是链接各章节。<br>接着看一下github上仓库项目结构（初步构成）。</p>
<p><img src="http://img.blog.csdn.net/20171010103114659?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>因为在线渲染电子书速度较慢，我们可以在本地进行渲染和修改。目前只需将仓库先克隆到本地。接着安装gitbook（基于node.js）。<br>因为gitbook是基于node.js的，先查看是否安装了node.js。</p>
<pre><code>node -v
npn -v
</code></pre><p><img src="http://img.blog.csdn.net/20171010145824528?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>接着输入命令，安装gitbook。</p>
<pre><code>npm install gitbook-cli -g
</code></pre><p><img src="http://img.blog.csdn.net/20171010145835836?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171010145939459?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>接下来在github上先安装gitbook的拓展应用。并选择应用的仓库范围（可以选择所有仓库，也可以只选择对应的仓库）</p>
<p><img src="http://img.blog.csdn.net/20171010150124228?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>这样在gitbook上创建新书的时候，可以选择github的模板，直接导入书籍的仓库，并且后面可以自动同步。</p>
<p><img src="http://img.blog.csdn.net/20171010145949441?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171010150240363?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>在gitbook的setting中设置，默认生成pdf，mobi，epub的电子书供下载，选择MIT许可证。</p>
<p><img src="http://img.blog.csdn.net/20171010150252215?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>gitbook可以通过book.json这个文件来控制生成电子书的一些具体定制化的需求。我的设置如下，因为用到了流程图和大量数学公式，就多加了katex和mermaid的插件。</p>
<p><img src="http://img.blog.csdn.net/20171010150909624?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>首先通过命令行，定位到克隆到本地书籍的路径。</p>
<pre><code>gitbook install
</code></pre><p>先安装插件。<br>接着渲染一下。</p>
<pre><code>gitbook build
</code></pre><p>最后本地服务器运行。</p>
<pre><code>gitbook serve
</code></pre><p>在浏览器网址输入localhost:4000。<br>即可查看。</p>
<p><img src="http://img.blog.csdn.net/20171010151537171?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171010151555095?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>执行gitbook build的时候可能会有各种报错，根据报错信息一个一个修改。目前发现似乎gitbook不太支持mathjax。而且公式里面不能有中文及中文标点符号，而且原来在博客上，两个$是表示数学符号，但是不是自己占一行。四个 $是表示独立的公式，必须另起一行。但是katex只认四个$。所以进行了一番较多修改，流程图目前也一直无法显示。mermaid跟我博客的流程图插件也不相同。我用的是flowchart，但是安装了似乎也不显示。最后就先用截图来表示了。<br>全部搞定后直接push到github上。</p>
<p><img src="http://img.blog.csdn.net/20171010191244823?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>发现gitbook上没有完全同步。可以从setting里面设置。</p>
<p><img src="http://img.blog.csdn.net/20171010192027061?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>OK，大工告成，接下来只需等它在线渲染成功就可以了。<br>PDF版本。</p>
<p><img src="http://img.blog.csdn.net/20171010192518241?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>每每看到封面的熊本分分钟出戏。。。</p>
<p>在线网址访问网址：<br><a href="https://giserdaishaoqing.gitbooks.io/note-of-applied-statistics-with-r-book/content/" target="_blank" rel="external">应用统计学与R语言实现学习笔记</a></p>
<p>有兴趣的同学可以下载这本电子书，也可以在评论留邮箱，可以发送给大家。</p>
<p>参考博客：</p>
<blockquote>
<ul>
<li><a href="http://www.ituring.com.cn/article/127744" target="_blank" rel="external">使用GitBook平台发布电子书</a></li>
<li><a href="http://blog.csdn.net/zhangjk1993/article/details/50380403" target="_blank" rel="external">【Gitbook】实用配置及插件介绍</a></li>
<li><a href="http://blog.csdn.net/axi295309066/article/details/61420694" target="_blank" rel="external">GitBook使用教程</a></li>
<li><a href="https://bookfere.com/post/287.html" target="_blank" rel="external">GitBook 制作 Kindle 电子书详细教程（可视化版）</a></li>
</ul>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/08/应用统计学与R语言实现学习笔记（十四）——案例与实践/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dai Shaoqing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GISerDaiShaoqing's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/08/应用统计学与R语言实现学习笔记（十四）——案例与实践/" itemprop="url">
                  应用统计学与R语言实现学习笔记（十四）——案例与实践
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-08T00:00:00+08:00">
                2017-10-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/统计与模型/" itemprop="url" rel="index">
                    <span itemprop="name">统计与模型</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/10/08/应用统计学与R语言实现学习笔记（十四）——案例与实践/" class="leancloud_visitors" data-flag-title="应用统计学与R语言实现学习笔记（十四）——案例与实践">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="chapter-14-case-and-practice"><a href="#Chapter-14-Case-and-Practice" class="headerlink" title="Chapter 14 Case and Practice"></a>Chapter 14 Case and Practice</h1><p>本篇是第十四章，内容是案例与实践。这里其实是对我公选课的作业做了个汇总。</p>
<h3 id="1-描述性统计与抽样分布"><a href="#1-描述性统计与抽样分布" class="headerlink" title="1 描述性统计与抽样分布"></a>1 描述性统计与抽样分布</h3><p>1.一种袋装食品用生产线自动装填，每袋重量大约为50g，但由于某些原因，每袋重量不会恰好是50g。下面是随机抽取的100袋食品，测得的重量数据见附录。<br>（1）构建这些数据的频数分布表。<br>（2）绘制频数分布的直方图。<br>（3）说明数据分布的特征。</p>
<p>2.甲乙两个班各有40名学生，期末统计学考试成绩的分布见附录。<br>（1）根据上面的数据，画出两个班考试成绩的复合柱形图、环形图和图饼图。<br>（2）比较两个班考试成绩分布的特点。<br>（3）画出雷达图，比较两个班考试成绩的分布是否相似。</p>
<p>3.随机抽取25个网络用户，得到他们的年龄数据（单位：周岁）见附录。<br>（1）计算众数、中位数。<br>（2）根据定义公式计算四分位数。<br>（3）计算平均数和标准差。<br>（4）计算偏态系数和峰态系数。<br>（5）对网民年龄的分布特征进行综合分析。</p>
<p>4.某银行为缩短顾客到银行办理业务等待的时间，准备采用两种排队方式进行试验：一种是所有顾客都进入一个等待队列；另一种是顾客在三个业务窗口处列队三排等待。为比较哪种排队方式使顾客等待的时间更短，两种排队方式各随机抽取的9名顾客，得到第一中排队方式的平均等待时间为7.2分钟，标准差为，1.97分钟，第二种排队方式的等待时间（单位：min）见附录。<br>（１）画出第二种排队方式等待时间的茎叶图。<br>（２）计算第二种排队方式等待时间的平均数和标准差。<br>（３）比较两种排队方式等待时间的离散程度。<br>（４）如果让你选择一种排队方式，你会选择哪一种？试说明理由。</p>
<p>5.从均值为200、标准差为50的总体中，抽取n=100的简单随机样本，用样本均值`x估计总体均值。<br>a)描述重复抽样的样本均值的抽样分布。<br>b)不重复抽样，总体单位数分别为10000、1000时的样本均值的抽样分布。 </p>
<h3 id="2-参数估计与假设检验"><a href="#2-参数估计与假设检验" class="headerlink" title="2 参数估计与假设检验"></a>2 参数估计与假设检验</h3><p>1.某大学为了解学生每天上网的时间，在全校7500名学生中采取不重复抽样方法随机抽取36人，调查他们每天上网的时间（单位：小时） ，得到的数据见附录。求该校大学生平均上网时间的置信区间，置信概率分别为90%、95%和99%。</p>
<p>2.假定两个总体的标准差分别为：$\sigma_1$=12，$\sigma_2$=15，若要求误差范围不超过5，相应的置信水平为95%，假定$n_1=n_2$，估计两个总体均值之差$m_1-m_2$时所需的样本容量为多大？ </p>
<p>3.经验表明，一个矩形的宽与长之比等于0.618的时候会给人们比较良好的感觉。某工艺品工厂生产的矩形工艺品框架的宽与长要求也按这一比例设计，假定其总体服从正态分布，现随机抽取了20个框架测得比值见附录。在显著性水平 ＝0.05时，能否认为该厂生产的工艺品框架宽与长的平均比例为0.618？。</p>
<p>4.一家大型超市连锁店上个月接到许多消费者投诉某种品牌炸土豆片中60克一袋的那种土豆片的重量不符。店方猜想引起这些投诉的原因是运输过程中沉积在食品袋底部的土豆片碎屑，但为了使顾客们对花钱买到的土豆片感到物有所值，店方仍然决定对来自于一家最大的供应商的下一批袋装炸土豆片的平均重量（克）进行检验，假设陈述如下：<br>                $H_0: \mu\le 60$      $H_1:\mu&lt;60$<br>如果有证据可以拒绝原假设，店方就拒收这批炸土豆片并向供应商提出投诉。<br>（1）与这一假设检验问题相关联的第一类错误是什么？<br>（2）与这一假设检验问题相关联的第二类错误是什么？<br>（3）你认为连锁店的顾客们会将哪类错误看得较为严重？而供应商会将哪类错误看得较为严重？</p>
<h3 id="3-方差分析与回归分析"><a href="#3-方差分析与回归分析" class="headerlink" title="3 方差分析与回归分析"></a>3 方差分析与回归分析</h3><p>1.某家电制造公司准备购进一批5#电池，现有A、B、C三个电池生产企业愿意供货，为比较它们生产的电池质量，从每个企业各随机抽取5只电池，经试验得其寿命（单位：h）数据见附录。试分析三个企业生产的电池的平均寿命之间有无显著差异（$\alpha=0.05$）。如果有差异，用LSD方法检验哪些企业之间有差异？</p>
<p>2.一家超市连锁店的老板进行一项研究，确定超市所在的位置和竞争者的数量对销售额是否有显著影响。获得的月销售额数据（单位：万元）见附录。取显著性水平$\alpha=0.01$，检验：<br>（1）竞争者的数量对销售额是否有显著影响。<br>（2）超市的位置对销售额是否有显著影响。<br>（3）竞争者的数量和超市的位置对销售额是否有交互影响。</p>
<p>3.附录中有随机抽取的15家大型商场销售的同类产品的有关数据（单位：元）。<br>（1）计算y与$x_1$ 、y与$x_2$之间的相关系数，是否有证据表明销售价格与购进价格、销售价格与销售费用之间存在线性关系？<br>（2）根据上述结果，你认为用购进价格和销售费用来预测销售价格是否有用？<br>（3）用Excel进行回归，并检验模型的线性关系是否显著（$\alpha=0.05$）。<br>（4）解释判定系数$R^2$，所得结论与问题（2）中是否一致?<br>（5）计算$x_1$与$x_2$之间的相关系数，所得结果意味着什么？<br>（6）模型中是否存在多重共线性？你对模型有何建议？</p>
<p>4.附录中有32名美士足球运动员的rating及其他相关信息。请建立一个回归模型以预测一位美士足球运动员的rating。提交报告包括：使用什么方法建立的模型，该方法的运行结果，最终模型的解释（拟合程度、预测误差）。</p>
<p>这一份作业汇总从最原始的描述统计、参数估计、假设检验到基础的方差分析与回归分析均有了。根据这里的习题即可对前面的内容再次熟悉。<br>这里就不多说了，我有一份比较完整的文档针对这份内容。这里先给出节选部分的截图。具体地址再给出。</p>
<p><img src="http://img.blog.csdn.net/20171008212639172?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008212657681?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008212723358?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008212739353?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008212759111?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008212820763?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008212841228?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008212915392?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008212933612?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008212957999?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008213029474?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008213047883?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171008213107161?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/06/应用统计学与R语言实现学习笔记（十三）——因子分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dai Shaoqing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GISerDaiShaoqing's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/06/应用统计学与R语言实现学习笔记（十三）——因子分析/" itemprop="url">
                  应用统计学与R语言实现学习笔记（十三）——因子分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-06T00:00:00+08:00">
                2017-10-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/统计与模型/" itemprop="url" rel="index">
                    <span itemprop="name">统计与模型</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/10/06/应用统计学与R语言实现学习笔记（十三）——因子分析/" class="leancloud_visitors" data-flag-title="应用统计学与R语言实现学习笔记（十三）——因子分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="chapter-13-factor-analysis"><a href="#Chapter-13-Factor-Analysis" class="headerlink" title="Chapter 13 Factor Analysis"></a>Chapter 13 Factor Analysis</h1><p>本篇是第十三章，内容是因子分析。</p>
<h3 id="1-因子分析概念"><a href="#1-因子分析概念" class="headerlink" title="1 因子分析概念"></a>1 因子分析概念</h3><p>因子分析是一种数据简化的技术。它通过研究众多变量之间的内部依赖关系，探求观测数据中的基本结构，并用少数几个假想变量来表示其基本的数据结构。这几个假想变量能够反映原来众多变量的主要信息。原始的变量是可观测的显在变量，而假想变量是不可观测的潜在变量，称为因子。<br>即一种用来在众多变量中辨别、分析和归结出变量间的相互关系并用简单的变量（因子）来描述这种关系的数据分析方法。<br><strong>寻求基本结构</strong></p>
<blockquote>
<ul>
<li>通过因子分析，找出几个较少的有实际意义的因子，反映出原来数据的基本结构。</li>
<li>通常找出的这组观察不到的因子概括了原始的变量的大多数信息。</li>
</ul>
</blockquote>
<p><strong>数据简化</strong></p>
<blockquote>
<ul>
<li>强相关问题会对分析带来困难。</li>
<li>通过因子分析，可以用所找出的少数几个因子代替原来的变量做回归分析、聚类分析、判别分析等。</li>
</ul>
</blockquote>
<p><strong>因子分析的用途</strong></p>
<blockquote>
<ul>
<li>产生新的、更少的变量以便为后续的回归和其他分析做基础。</li>
<li>识别概念或产品的基本感知和特性。</li>
<li>改善市场研究领域多元测量的结构与方法。</li>
</ul>
</blockquote>
<h3 id="2-因子分析模型"><a href="#2-因子分析模型" class="headerlink" title="2 因子分析模型"></a>2 因子分析模型</h3><p><strong>数学模型</strong><br>设$X_i(i=1,2,\cdots,p)$p个变量，如果表示为：<br>$$ X_i=\mu_i+a_{i1}F_1+\cdots+a_{im}F_m+\varepsilon_i(m\le p) $$<br>或<br>$$ \begin {bmatrix} X_1\\X_2\\\vdots\\X_p  \end {bmatrix}=\begin {bmatrix} \mu_1\\\mu_2\\\vdots\\\mu_p  \end {bmatrix}+\begin {bmatrix} \alpha_{11}&amp;\alpha_{12}&amp;\cdots&amp;\alpha_{1m}\\\alpha_{21}&amp;\alpha_{22}&amp;\cdots&amp;\alpha_{2m}\\\vdots&amp;\vdots&amp;&amp;\vdots\\\alpha_{p1}&amp;\alpha_{p2}&amp;\cdots&amp;\alpha_{pm} \end {bmatrix}\begin {bmatrix} F_1\\F_2\\\vdots\\F_m  \end {bmatrix}+\begin{bmatrix} \varepsilon_1\ \varepsilon_2\\\vdots\ \varepsilon_p  \end {bmatrix} $$<br>或$$ X-\mu=AF+\varepsilon $$<br>$F_1,F_2,\cdots,F_m$称为公共因子,是不可观测的变量，它们的系数称为因子载荷。$\varepsilon_i$是特殊因子，是不可能被前m个公共因子包含的部分。并且满足：<br>$cov(F,\varepsilon)=0$，即$F,\varepsilon$不相关；<br>$$ D(F)=\begin {bmatrix} 1 &amp; &amp; &amp; \\&amp;1&amp;&amp;&amp;\\&amp;&amp;\ddots&amp;\\&amp;&amp;&amp;1 \end {bmatrix}=I $$<br>即$F_1,F_2,\cdots,F_m$互不相关，方差为1。<br>$$ D(\varepsilon)=\begin {bmatrix}\sigma_1^2&amp;&amp;&amp;\\&amp;\sigma_w^2&amp;&amp;&amp;\\&amp;&amp;\ddots&amp;\\&amp;&amp;&amp;\sigma_p^2\end {bmatrix} $$<br>即$\varepsilon_i\sim N(0,\sigma_i^2)$互不相关，方差不一定相等。<br><strong>用矩阵的方式表达</strong><br>$$ X-\mu=AF+\varepsilon $$ $$ E(F)=0 $$ $$ E(\varepsilon)=0 $$ $$ Var(F)=1 $$<br>$$ cov(F,\varepsilon)=E(F\varepsilon’)=\begin {pmatrix}E(F_1\varepsilon_1)&amp;E(F_1\varepsilon_2)&amp;\cdots&amp;E(F_1\varepsilon_p)\\E(F_2\varepsilon_1)&amp;E(F_2\varepsilon_2)&amp;\cdots&amp;E(F_2\varepsilon_p)\\\vdots&amp;\vdots&amp;&amp;\vdots\\E(F_p\varepsilon_1)&amp;E(F_p\varepsilon_2)&amp;\cdots&amp;E(F_p\varepsilon_p) \end {pmatrix}=0 $$<br>$$ Var(\varepsilon)=diag(\sigma_1^2,\sigma_2^2,\cdots,\sigma_p^2) $$<br><strong>因子分析模型的性质</strong></p>
<blockquote>
<p>1、原始变量X的协方差矩阵的分解<br>$$ \Sigma_x=AA’+D $$<br>A是因子模型的系数<br>$$ Var(\varepsilon)=D=diag(\sigma_1^2,\sigma_2^2,\cdots,\sigma_p^2) $$<br>D的主对角线上的元素值越小，则公共因子共享的成分越多。<br>2、模型不受计量单位的影响。<br>3、因子载荷不是惟一的：设T为一个p×p的正交矩阵，令A<em>=AT， F</em>=T’F也是一个满足因子模型条件的因子载荷。</p>
</blockquote>
<p><strong>因子载荷矩阵中的统计特征</strong></p>
<blockquote>
<ul>
<li>因子载荷$a_{ij}$是第i个变量与第j个公共因子的相关系数。</li>
<li>变量$X_i$的共同度是因子载荷矩阵的第i行的元素的平方和。记为$h_i^2=\sum_{i=1}^ma_{ij}^2$<br>所有的公共因子和特殊因子对变量$X_i$的贡献为1。如果$\sum_{i=1}^ma_{ij}^2$非常靠近1， $\sigma_i^2$非常小，则因子分析的效果好，从原变量空间到公共因子空间的转化性质好。</li>
<li>因子载荷矩阵中各列元素的平方和$S_j=\sum_{i=1}^pa_{ij}^2$称为$F_j(j=1,2,\cdots,m)$对所有的$X_i$的方差贡献和。衡量$F_j$的相对重要性。</li>
</ul>
</blockquote>
<h3 id="3-因子载荷矩阵的估计方法"><a href="#3-因子载荷矩阵的估计方法" class="headerlink" title="3 因子载荷矩阵的估计方法"></a>3 因子载荷矩阵的估计方法</h3><blockquote>
<ul>
<li>主成分分析法<br>设随机向量$x=(x_1,x_2,\cdots,x_p)’$的均值为$\mu$，协方差为$\Sigma$，$\lambda_1\ge\lambda_2\ge\cdots\ge\lambda_p\ge0$为$\Sigma$的特征根，$u_1,u_2,\cdots,u_p$为对应的标准化特征向量，则：<br>$$ \Sigma=U\begin {bmatrix}\lambda_1&amp;&amp;&amp;\\&amp;\lambda_2&amp;&amp;\\&amp;&amp;\cdots&amp;\\&amp;&amp;&amp;\lambda_p \end {bmatrix}U’=AA’+D=\begin {bmatrix}\sqrt\lambda_1u_1&amp;\sqrt\lambda_2u_2&amp;\cdots&amp;\sqrt\lambda_pu_p \end {bmatrix}\begin {bmatrix}\sqrt\lambda_1u_1’\\\sqrt\lambda_2u_2’\\\vdots\\\sqrt\lambda_pu_p’ \end {bmatrix}+D $$<br>上式给出的Σ表达式是精确的，然而，它实际上是毫无价值的，因为我们的目的是寻求用少数几个公共因子解释，故略去后面的p-m项的贡献。<br>上式有一个假定：模型中的特殊因子是不重要的，因而从Σ的分解中忽略了特殊因子的方差。<br>确定因子个数（特征根大于1所对应的特征向量；碎石原则：把特征根从大到小排列，把特征根减小速度变缓的特征根都删掉）。</li>
<li><p>主因子法<br>主因子方法是对主成分方法的修正，假定我们首先对变量进行标准化变换。则<br>$$ R=AA’+D\\R^{\ast}=AA’=R-D $$<br>称$R^{\ast}$为约相关矩阵，$R^{\ast}$对角线上的元素是$h_i^2$，而不是1。<br>$$ R^{\ast}=R-\hat D=\begin {bmatrix}\hat h_1^2&amp;r_{12}&amp;\cdots&amp;r_{1p}\\r_{21}&amp;\hat h_2^2&amp;\cdots&amp;r_{2p}\\\vdots&amp;\vdots&amp;&amp;\vdots\\r_{p1}&amp;r_{p2}&amp;\cdots&amp;\hat h_p^2 \end {bmatrix} $$<br>直接求$R^{\ast}$的前p个特征根和对应的正交特征向量。得如下的矩阵：<br>$$A=\begin {bmatrix}\sqrt{\lambda_1^{\ast}}u_1^{\ast}&amp;\sqrt{\lambda_2^{\ast}}u_2^{\ast}&amp;\cdots&amp;\sqrt{\lambda_p^{\ast}}u_p^{\ast} \end {bmatrix}$$<br>$R^{\ast}$特征根：$\lambda_1^{\ast}\ge\lambda_2^{\ast}\ge\cdots\ge\lambda_p^{\ast}\ge0$，正交特征向量：$u_1^{\ast},u_2^{\ast},\cdots,u_p^{\ast}$<br>当特殊因子$\varepsilon_i$的方差已知：<br>$$ R^{\ast}=R-\begin {bmatrix}\sigma_1^2&amp;&amp;&amp;\\&amp;\sigma_2^2&amp;&amp;\\&amp;&amp;\ddots&amp;\\&amp;&amp;&amp;\sigma_p^2 \end {bmatrix}=\begin {bmatrix}\sqrt{\lambda_1^{\ast}}u_1^{\ast}&amp;\sqrt{\lambda_2^{\ast}}u_2^{\ast}&amp;\cdots&amp;\sqrt{\lambda_p^{\ast}}u_p^{\ast} \end {bmatrix}\begin {bmatrix}\sqrt{\lambda_1^{\ast}}u_1^{‘\ast}\\\sqrt{\lambda_2^{\ast}}u_2^{‘\ast}\\\vdots\\\sqrt{\lambda_p^{\ast}}u_p^{‘\ast} \end {bmatrix} $$<br>$$ A=\begin {bmatrix}\sqrt{\lambda_1^{\ast}}u_1^{\ast}&amp;\sqrt{\lambda_2^{\ast}}u_2^{\ast}&amp;\cdots&amp;\sqrt{\lambda_m^{\ast}}u_m^{\ast}\end {bmatrix} $$<br>$$ D=\begin {pmatrix}1-\hat h_1^2&amp;&amp;0\\&amp;\ddots&amp;\\0&amp;&amp;1-\hat h_p^2 \end {pmatrix} $$<br>在实际的应用中，个性方差矩阵一般都是未知的，可以通过一组样本来估计。估计的方法有如下几种：<br>首先，求$h_i^2$的初始估计值，构造出R*<br>1、取$h_i^2=1$，在这个情况下主因子解与主成分解等价；<br>2、取$h_i^2=R_i^2$，$R_i^2$为$x_i$与其他所有的原始变量$x_j$的复相关系数的平方，即$x_i$对其余的p-1个$x_j$的回归方程的判定系数，这是因为xi与公共因子的关系是通过其余的p-1个$x_j$的线性组合联系起来的；<br>3、取$\hat h_i^2=max\left|r_{ij}\right|(j\neq i)$，这意味着取$x_i$与其余的$x_j$的简单相关系数的绝对值最大者；<br>4、取$h_i^2=\frac{1}{p-1}\sum_{j=1,j\neq i}^pr_{ij}$，其中要求该值为正数。<br>5、取$h_i^2=1/r^{ii}$，其中$r^{ii}$是$R^{-1}$的对角元。</p>
</li>
<li><p>极大似然估计法<br>如果假定公共因子F和特殊因子$\varepsilon$服从正态分布，那么可以得到因子载荷和特殊因子方差的极大似然估计。设$x_1,x_2,\cdots,x_n$为来自正态总体$N_p(\mu,\Sigma)$的随机样本。$\Sigma=AA’+\Sigma_{\varepsilon}$<br>$$\begin {aligned} L(\hat \mu,\hat A,\hat D)&amp;=f(X)=f(X_1)\cdot f(X_2)\cdots f(X_n)\\&amp;=\prod_{i=1}^n(2\pi)^{-p/2}\left |\Sigma\right|^{1/2}exp\begin {bmatrix}-\frac{1}{2}(x_i-\mu)’\Sigma^{-1}(x_i-\mu) \end {bmatrix}\\&amp;=\begin {bmatrix}(2\pi)^p\left |\Sigma \right |^{-n/2} \end {bmatrix}exp\begin {bmatrix}-\frac{1}{2}\sum_{i=1}^n(X_i-\mu)’\Sigma^{-1}(X_i-\mu) \end {bmatrix} \end {aligned} $$<br>用数值极大化的方法可以得到极大似然估计。</p>
</li>
</ul>
</blockquote>
<h3 id="4-因子旋转正交变换"><a href="#4-因子旋转（正交变换）" class="headerlink" title="4 因子旋转（正交变换）"></a>4 因子旋转（正交变换）</h3><p><strong>旋转因子的目的</strong><br>因子分析的目的不仅仅是要找出公共因子以及对变量进行分组，更重要的是要知道每个公共因子的意义，以便进行进一步的分析。如果每个公共因子的含义不清，则不便于进行实际背景的解释。<br>初始因子的综合性太强，难以找出因子的实际意义。由于因子载荷阵是不唯一的，所以可以对因子载荷阵进行旋转，使因子载荷阵的结构简化，使其每列或行的元素平方值向0和1两极分化。<br><strong>旋转方法</strong><br>设$\Gamma$正交矩阵，做正交变换$B=A\Gamma$。</p>
<blockquote>
<ul>
<li>变换后各变量的共同度不会发生变化。</li>
<li>变换后各因子的贡献会发生变化。</li>
</ul>
</blockquote>
<p>三种主要的正交旋转法</p>
<blockquote>
<ul>
<li>方差最大法<br>方差最大法从简化因子载荷矩阵的每一列出发，使和每个因子有关的载荷的平方的方差最大。当只有少数几个变量在某个因子上有较高的载荷时，对因子的解释最简单。 方差最大的直观意义是希望通过因子旋转后，使每个因子上的载荷尽量拉开距离，一部分的载荷趋于±1，另一部分趋于0。<br>$$ A=\begin {bmatrix} a_{11}&amp;a_{12}\\a_{21}&amp;a_{22}\\\vdots&amp;\vdots\\a_{p1}&amp;a_{p2} \end {bmatrix} $$<br>$$ X_1=a_{11}F_1+a_{12}F_2\\X_2=a_{21}F_1+a_{22}F_2\\\cdots\\X_p=a_{p1}F_1+a_{p2}F_2  $$<br>设旋转矩阵：$ T=\begin {pmatrix}\cos\varphi&amp;-\sin\varphi\\\sin\varphi&amp;\cos\varphi \end {pmatrix} $<br>则$$ \begin {aligned}B&amp;=AT=A\begin {pmatrix}\cos\varphi&amp;-\sin\varphi\\\sin\varphi&amp;\cos\varphi \end {pmatrix}\\&amp;=\begin {pmatrix}a_{11}\cos\varphi+a_{12}\sin\varphi&amp;-a_{11}\sin\varphi+a_{12}\cos\varphi\\\vdots&amp;\vdots\\a_{p1}\cos\varphi+a_{p2}\sin\varphi&amp;-a_{p1}\sin\varphi+a_{p2}\cos\varphi \end {pmatrix}\\&amp;=\begin {pmatrix}a_{11}^{\ast}&amp;a_{12}^{\ast}\\\vdots&amp;\vdots\\a_{p1}^{\ast}&amp;a_{p2}^{\ast} \end {pmatrix} \end {aligned} $$<br>令$ d_{ij}=\frac{a_{ij}^{\ast}}{h_i},i=1,2,\cdots,p;j=1,2 $<br>$ \bar d_j=\frac{1}{p}\sum_{i=1}^pd_{ij}^2 $（这是列和）<br>简化准则为：$ V(\theta)=\sum_{j=1}^m\sum_{i=1}^p(d_{ij}^2-\bar d_j)^2=max $<br>即：$ V_1+V_2+V_3+\cdots+V_m=max $<br>令$ \frac{\partial V}{\partial \theta}=0 $，则可以解出$ \theta_0 $<br>旋转矩阵为：$ T=\begin {pmatrix}\cos\theta_0&amp;-\sin\theta_0\\\sin\theta_0&amp;\cos\theta_0 \end {pmatrix} $</li>
<li>四次方最大法<br>四次方最大旋转是从简化载荷矩阵的行出发，通过旋转初始因子，使每个变量只在一个因子上有较高的载荷，而在其它的因子上尽可能低的载荷。 如果每个变量只在一个因子上有非零的载荷，这时的因子解释是最简单的。四次方最大法通过使因子载荷矩阵中每一行的因子载荷平方的方差达到最大。<br>简化准则为：$ Q=\sum_{i=1}^p\sum_{j=1}^m(b_{ij}^2-\frac{1}{m})^2=max $<br>$$ \begin {aligned} Q&amp;=\sum_{i=1}^p\sum_{j=1}^m(b_{ij}^2-\frac{1}{m})^2=\sum_{i=1}^p\sum_{j=1}^m(b_{ij}^4-2\frac{1}{m}b_{ij}^2+\frac{1}{m^2})\\&amp;=\sum_{i=1}^p\sum_{j=1}^m(b_{ij}^4-2\sum_{i=1}^p\sum_{j=1}^m\frac{1}{m}b_{ij}^2+\sum_{i=1}^p\sum_{j=1}^m\frac{1}{m^2})\\&amp;=\sum_{i=1}^p\sum_{j=1}^m(b_{ij}^4-2\sum_{i=1}^p\sum_{j=1}^m\frac{1}{m}b_{ij}^2+\sum_{i=1}^p\sum_{j=1}^m\frac{1}{m^2})\\&amp;=\sum_{i=1}^p\sum_{j=1}^m(b_{ij}^4-2+\frac{p}{m}) \end {aligned} $$<br>最终的简化准则为：$ Q=\sum_{i=1}^p\sum_{j=1}^mb_{ij}^4=MAX $</li>
<li>等量最大法<br>等量最大法把四次方最大法和方差最大法结合起来求Q和V的加权平均最大。<br>最终的简化准则为：$ E=\sum_{i=1}^p\sum_{j=1}^mb_{ij}^4-\gamma\sum_{j=1}^m(\sum_{i=1}^pb_{ij}^2)^2/p=MAX $<br>权数$\gamma$等于$m/2$，因子数有关。</li>
</ul>
</blockquote>
<h3 id="5-因子得分"><a href="#5-因子得分" class="headerlink" title="5 因子得分"></a>5 因子得分</h3><p>当解决了用一组公共因子的线性组合来表示一组观测变量后，有时我们需要使用这些因子做其他的研究。比如把得到的因子作为自变量来做回归分析，对样本进行分类或评价，这就需要我们对公共因子进行测度，即给出公共因子的值。<br><strong>因子得分</strong><br>因子分析的数学模型：<br>$$ \begin {bmatrix}X_1\\X_2\\\vdots\\X_p \end {bmatrix}=\begin {bmatrix}\alpha_{11}&amp;\alpha_{12}&amp;\cdots&amp;\alpha_{1m}\\\alpha_{21}&amp;\alpha_{22}&amp;\cdots&amp;\alpha_{2m}\\\vdots&amp;\vdots&amp;&amp;\vdots\\\alpha_{p1}&amp;\alpha_{p2}&amp;\cdots&amp;\alpha_{pm} \end {bmatrix}\begin {bmatrix}F_1\\F_2\\\vdots\\F_p \end {bmatrix} $$<br>原变量被表示为公共因子的线性组合，当载荷矩阵旋转之后，公共因子可以做出解释，通常的情况下，我们还想反过来把公共因子表示为原变量的线性组合。<br>因子得分函数：$F_j=\beta_{j1}X_1+\cdots+\beta_{jp}X_p, j=1,\cdots,m$。<br>可见，要求得每个因子的得分，必须求得分函数的系数，而由于p&gt;m，所以不能得到精确的得分，只能通过估计。<br><strong>巴特莱特因子得分(加权最小二乘法）</strong><br>把$x_i-\mu_i$看作因变量；把因子载荷矩阵<br>$$ \begin {bmatrix}\alpha_{11}&amp;\alpha_{12}&amp;\cdots&amp;\alpha_{1m}\\\alpha_{21}&amp;\alpha_{22}&amp;\cdots&amp;\alpha_{2m}\\\vdots&amp;\vdots&amp;&amp;\vdots\\\alpha_{p1}&amp;\alpha_{p2}&amp;\cdots&amp;\alpha_{pm} \end {bmatrix} $$<br>看成自变量的观测；把某个个案的得分$F_j$看作最小二乘法需要求的系数。<br>$$ \begin {cases}x_{i1}-\mu_1=a_{11}f_1+a_{12}f_2+\cdots+a_{1m}f_m+\varepsilon_1\\x_{i2}-\mu_2=a_{21}f_1+a_{22}f_2+\cdots+a_{2m}f_m+\varepsilon_2\\\cdots\\x_{ip}-\mu_p=a_{p1}f_1+a_{p2}f_2+\cdots+a_{pm}f_m+\varepsilon_p \end {cases} $$<br>由于特殊因子的方差相异，所以用加权最小二乘法求得分，每个个案作一次，要求出所有样品的得分，需要作n次。<br>$$ \sum_{j=1}^p[(x_i-\mu_i)-(a_{i1}\hat f_1+a_{i2}\hat f_2+\cdots+a_{im}\hat f_m)]^2/\sigma_i^2 $$<br>使上式最小的$\hat f_1,\cdots,\hat f_m$是相应个案的因子得分。<br><strong>回归方法</strong><br>$$ \begin {bmatrix}X_1\\X_2\\\vdots\\X_n \end {bmatrix}=\begin {bmatrix}\alpha_{11}&amp;\alpha_{12}&amp;\cdots&amp;\alpha_{1m}\\\alpha_{21}&amp;\alpha_{22}&amp;\cdots&amp;\alpha_{2m}\\\vdots&amp;\vdots&amp;&amp;\vdots\\\alpha_{p1}&amp;\alpha_{p2}&amp;\cdots&amp;\alpha_{pm} \end {bmatrix}\begin {bmatrix}F_1\\F_2\\\vdots\\F_p \end {bmatrix}+\begin {bmatrix}\varepsilon_1\\\varepsilon_2\\\vdots\\\varepsilon_n \end {bmatrix} $$<br>$$ \hat F_j=b_{j1}X_1+\cdots+b_{jp}X_p, j=1,\cdots,m $$<br>$$ \begin {bmatrix}b_{11}&amp;b_{12}&amp;\cdots&amp;b_{1p}\\b_{21}&amp;b_{22}&amp;\cdots&amp;b_{2p}\\\vdots&amp;\vdots&amp;&amp;\vdots\\b_{m1}&amp;b_{m2}&amp;\cdots&amp;b_{mp} \end {bmatrix}=\begin {bmatrix}b_1\\b_2\\\vdots\\b_m \end {bmatrix} $$<br>$$ \begin {aligned} \alpha_{ij}=\gamma_{x_iF_j}=E(X_i,F_j)&amp;=E[X_i(b_{j1}X_1+\cdots+b_{jp}X_p)]\\&amp;=b_{j1}\gamma_{i1}+\cdots+b_{jp}\gamma_{ip}=\begin {bmatrix}\gamma_{i1}&amp;\gamma_{i2}&amp;\cdots&amp;\gamma_{ip} \end {bmatrix}\begin {bmatrix}b_{j1}\\b_{j2}\\\vdots\\b_{jp} \end {bmatrix} \end {aligned}$$<br>则，我们有如下的方程组：<br>$$ \begin {bmatrix}\gamma_{11}&amp;\gamma_{12}&amp;\cdots&amp;\gamma_{1p}\\\gamma_{21}&amp;\gamma_{22}&amp;\cdots&amp;\gamma_{2p}\\\vdots&amp;\vdots&amp;&amp;\vdots\\\gamma_{p1}&amp;\gamma_{p2}&amp;\cdots&amp;\gamma_{pp} \end {bmatrix}\begin {bmatrix}b_{j1}\\b_{j2}\\\vdots\\b_{jp} \end {bmatrix}=\begin {bmatrix}a_{1j}\\a_{2j}\\\vdots\\a_{pj} \end {bmatrix},j=1,2,\cdots,m $$<br>$\begin {bmatrix}\gamma_{11}&amp;\gamma_{12}&amp;\cdots&amp;\gamma_{1p}\\\gamma_{21}&amp;\gamma_{22}&amp;\cdots&amp;\gamma_{2p}\\\vdots&amp;\vdots&amp;&amp;\vdots\\\gamma_{p1}&amp;\gamma_{p2}&amp;\cdots&amp;\gamma_{pp} \end {bmatrix}$为原始变量的相关系数；$\begin {bmatrix}b_{j1}\\b_{j2}\\\vdots\\b_{jp} \end {bmatrix}$为第j个因子得分函数的系数；$\begin {bmatrix}a_{1j}\\a_{2j}\\\vdots\\a_{pj} \end {bmatrix}$为载荷矩阵的第 j列<br><strong>注：共需要解m次才能解出所有的得分函数的系数。</strong></p>
<h3 id="6-因子分析步骤"><a href="#6-因子分析步骤" class="headerlink" title="6 因子分析步骤"></a>6 因子分析步骤</h3><blockquote>
<ul>
<li>选择分析的变量<br>用定性分析和定量分析的方法选择变量，因子分析的前提条件是观测变量间有较强的相关性，因为如果变量之间无相关性或相关性较小的话，他们不会有共享因子，所以原始变量间应该有较强的相关性。</li>
<li>计算所选原始变量的相关系数矩阵<br>相关系数矩阵描述了原始变量之间的相关关系。可以帮助判断原始变量之间是否存在相关关系，这对因子分析是非常重要的，因为如果所选变量之间无关系，做因子分析是不恰当的。并且相关系数矩阵是估计因子结构的基础。</li>
<li>提取公共因子<br>这一步要确定因子求解的方法和因子的个数。需要根据研究者的设计方案或有关的经验或知识事先确定。因子个数的确定可以根据因子方差的大小，只取方差大于1(或特征值大于1)的那些因子，因为方差小于1的因子其贡献可能很小。或者按照因子的累计方差贡献率来确定，一般认为要达到60％才能符合要求。</li>
<li>因子旋转<br>通过坐标变换使每个原始变量在尽可能少的因子之间有密切的关系，这样因子的实际意义更容易解释,也更容易为每个潜在因子赋予有实际意义的名字。</li>
<li>计算因子得分<br>求出各样本的因子得分，有了因子得分值，则可以在许多分析中使用这些因子，例如以因子的得分做聚类分析的变量，做回归分析中的回归因子。</li>
</ul>
</blockquote>
<p><strong>注</strong></p>
<blockquote>
<ul>
<li>因子分析是十分主观的，在许多出版的资料中，因子分析模型都用少数可命名因子提供了合理解释。实际上，绝大多数因子分析并没有产生如此明确的结果。不幸的是，评价因子分析质量的法则尚未很好量化，质量问题只好依赖一个“哇！”准则如果在仔细检查因子分析的时候，研究人员能够喊出“哇，我明白这些因子”的时候，就可认为是成功地运用了因子分析方法。</li>
</ul>
</blockquote>
<p><strong>主成分分析与因子分析</strong><br>主成分分析与因子分析有所不同，主成分分析仅仅是变量变换。</p>
<blockquote>
<ul>
<li>主成分分析：原始变量的线性组合表示新的综合变量，即主成分。</li>
<li>因子分析：潜在的假想变量和随机影响变量的线性组合表示原始变量。因子模型除了公共因子外还有特殊因子。公共因子只解释了原来变量的部分方差，而全部主成分解释了原来变量的全部方差。</li>
</ul>
</blockquote>
<p>主成分和公共因子的位置不同。因子分析也有因子载荷（ factor loading）的概念，代表了因子和原先变量的相关系数。但是在因子分析公式中的因子载荷位置和主成分分析不同。<br>在数学模型上，因子分析和主成分分析也有不少区别。而且因子分析的计算也复杂得多。根据因子分析模型的特点，它还多一道程序：因子旋转（ factor rotation）；这个步骤可以使结果更好。<br>旋转后的公共因子一般没有主成分那么综合，公共因子往往可以找到实际意义，而主成分常找不到实际的含义。<br>可以看出，因子分析和主成分分析都依赖于原始变量，也只能反映原始变量的信息。所以原始变量的选择很重要。在得到分析的结果时，并不一定会都得到如我们例子那样清楚的结果。这与问题的性质，选取的原始变量以及数据的质量等都有关系。如果原始变量本质上独立，就很难把很多独立变量用少数综合的变量概括，降维就可能失败。数据越相关，降维效果就越好。可用如下方法进行变量间的相关性检验：</p>
<blockquote>
<ul>
<li>KMO样本测度： KMO在0.9以上，非常适合； 0.8-0.9，很适合； 0.7-0.8，适合； 0.6-0.7，不太适合；<br>0.5-0.6；很勉强； 0.5以下，不适合；</li>
<li>巴特莱特球体检验： H0：相关系数矩阵R为单位阵I。拒绝时H0可作因子分析</li>
</ul>
</blockquote>
<h3 id="7-因子分析的r语言实现"><a href="#7-因子分析的R语言实现" class="headerlink" title="7 因子分析的R语言实现"></a>7 因子分析的R语言实现</h3><p>R语言做因子分析这里主要介绍三个函数，一个是自带的factanal函数。</p>
<pre><code>factanal(x,factors,data=NULL,covmat=NUL,n.obs=NA,subset,na.action,start=NULL,score=c(&quot;none&quot;,&quot;regression&quot;,&quot;Bartlett&quot;),rotation=&quot;varimax&quot;,control=NULL,…)
</code></pre><p>x是公式或者用于因子分析的数据，可以是矩阵（每一行为一个样本）或数据框；factors表示要生成的因子个数；data指定数据集，当x为公式的时候使用；covmat是样本的协方差矩阵或者相关系数矩阵，使用这个参数的时候x可以忽略；scores表示计算因子得分的方法；rotation表示因子旋转的方法，默认为”varimax”，最大方差旋转。这里近介绍几个常用的几个参数，其他参数说明可查询R语言官方帮助。另外，这个函数事实上仅支持用极大似然估计方法做因子分析。<br>第二个函数就是自编函数实现的主成分分析方法做因子分析（具体函数代码后面给出）。</p>
<pre><code>factor.analysis(x,m)
</code></pre><p>x为相关系数矩阵，m为因子个数。<br>第三个函数是psych包里的fa函数。</p>
<pre><code>fa（r，nfactors=，n.obs=，rotate=，scores=，fm）
</code></pre><p>r是相关系数矩阵或原始数据矩阵；nfactors设定提取的因子数（默认为1）；n.obs是观测数（输入相关系数矩阵时需要填写）；rotate设定放置的方法（默认互变异数最小法）；scores设定是否计算因子得分（默认不计算）；fm设定因子化方法（默认极小残差法）。<br>用上一章提供的数据再进行因子分析。比较不同函数结果的差异。<br>基于factnal函数，3个因子。</p>
<p><img src="http://img.blog.csdn.net/20171006171325567?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>基于自编函数，3个因子。</p>
<p><img src="http://img.blog.csdn.net/20171006171646756?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>基于fa函数，3个因子。</p>
<p><img src="http://img.blog.csdn.net/20171006171827685?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171006171925164?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20171006171946111?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/22/应用统计学与R语言实现学习笔记（十二）——主成分分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dai Shaoqing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GISerDaiShaoqing's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/22/应用统计学与R语言实现学习笔记（十二）——主成分分析/" itemprop="url">
                  应用统计学与R语言实现学习笔记（十二）——主成分分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-22T00:00:00+08:00">
                2017-09-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/统计与模型/" itemprop="url" rel="index">
                    <span itemprop="name">统计与模型</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/09/22/应用统计学与R语言实现学习笔记（十二）——主成分分析/" class="leancloud_visitors" data-flag-title="应用统计学与R语言实现学习笔记（十二）——主成分分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="chapter-12-priciple-component-analysis"><a href="#Chapter-12-Priciple-Component-Analysis" class="headerlink" title="Chapter 12 Priciple Component Analysis"></a>Chapter 12 Priciple Component Analysis</h1><p>本篇是第十二章，内容是主成分分析。</p>
<h3 id="1-主成分分析基本思想"><a href="#1-主成分分析基本思想" class="headerlink" title="1 主成分分析基本思想"></a>1 主成分分析基本思想</h3><p>依旧从问题开始本篇的介绍。地理学和生态学研究里经常遇到的问题就是，影响变量非常之多，而且地球表层地理生态环境现象无法使用控制变量的方式进行实验。同时影响变量非常多，经常出现变量冗余、冗杂的现象，同时多元分布数据本身对人类的认知就是一种挑战。这里举个栗子：比如在研究城市经济发展的时候，我们会考虑到的因素会包括第一产业、第二产业、第三产业占比，城市人口，城市地理位置，城市气候适宜度，政策扶持等等很多因子，但是这里有很多因子存在共线性的情况，也就是变量冗余冗杂。用矛盾论的话说，要抓住主要矛盾，那么如何在多元分布数据中分离出主要的因子，这就是本篇的主角主成分分析（Priciple Component Analysis，PCA）。</p>
<p>所以它的<strong>基本思想</strong>是。</p>
<p>在社会经济的研究中，为了全面系统的分析和研究问题，必须考虑许多经济指标，这些指标能从不同的侧面反映我们所研究的对象的特征，但在某种程度上存在信息的重叠，具有一定的相关性。这种信息的重叠有时甚至会抹杀事物的真正特征与内在规律。<br>主成分分析是利用降维的思想， 在力求数据信息丢失最少的原则下，对高维的变量空间降维，即在众多变量中找出少数几个综合指标（原始变量的线性组合），并且这几个综合指标将尽可能多地保留原来指标变异方面的信息，且这些综合指标互不相关。这些综合指标就称为主成分。主成分的数目少于原始变量的数目。<br>在一个低维空间识辨系统要比在一个高维空间容易得多。因此，更容易抓住主要矛盾，揭示事物内部变量之间的规律性，使问题得到简化，提高分析效率。指标间具有相关性是做主成分分析的前提。<br>主成分分析是一种数学变换方法，它把给定的一组变量通过线性变换转换为一组不相关的变量。在这种变换中，保持变量的总方差不变，同时，使第一主成分具有最大方差，第二主成分具有次大方差，依此类推。<br><strong>主成分与原始变量间的关系</strong><br>（1）每一个主成分是原始变量的线性组合。<br>（2）主成分的数目少于原始变量的数目。<br>（3）主成分保留了原始变量的大多数变异信息。<br>（4）各主成分间互不相关。</p>
<h3 id="2-几何解释与数学模型"><a href="#2-几何解释与数学模型" class="headerlink" title="2 几何解释与数学模型"></a>2 几何解释与数学模型</h3><h4 id="21-几何解释"><a href="#2-1-几何解释" class="headerlink" title="2.1 几何解释"></a>2.1 几何解释</h4><p>假定只有二维，即只有两个变量，由横坐标和纵坐标所代表；每个观测值都有相应于这两个坐标轴的坐标值。如果这些数据形成一个椭圆形状的点阵（这在二维正态的假定下是可能的）该椭圆有一个长轴和一个短轴。在短轴方向上数据变化较少。在极端的情况，短轴如退化成一点，长轴的方向可以完全解释这些点的变化，由二维到一维的降维就自然完成了。</p>
<p><img src="http://img.blog.csdn.net/20170920201148730?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>由图可以看出这些样本点无论是沿着$x_l$轴方向或$x_2$轴方向都具有较大的离散性，其离散的程度可以分别用观测变量$x_l$的方差和$x_2$的方差定量地表示。显然，如果只考虑$x_1$和$x_2$中的任何一个，那么包含在原始数据中的经济信息将会有较大的损失。<br>当坐标轴和椭圆的长短轴平行，那么代表长轴的变量就描述了数据的主要变化，而代表短轴的变量就描述了数据的次要变化。但是，坐标轴通常并不和椭圆的长短轴平行。因此，需要寻找椭圆的长短轴，并进行变换，使得新变量和椭圆的长短轴平行。如果长轴变量代表了数据包含的大部分信息，就用该变量代替原先的两个变量（舍去次要的一维），降维就完成了。椭圆的长短轴相差得越大，降维也越有道理。</p>
<h4 id="22-数学模型"><a href="#2-2-数学模型" class="headerlink" title="2.2 数学模型"></a>2.2 数学模型</h4><p>如果我们将xl轴和x2轴先平移，再同时按逆时针方向旋转$\theta$角度，得到新坐标轴Fl和F2。Fl和F2是两个新变量。根据旋转变换的公式：<br>$$ \begin{cases} y_1=x_1\cos\theta+x_2\sin\theta\\y_2=-x_1\sin\theta+x_2\cos\theta \end{cases} $$<br>$$ \begin{pmatrix} y_1\\y_2 \end{pmatrix}=\begin{pmatrix} \cos\theta &amp; \sin\theta\\-sin\theta &amp; \cos\theta \end{pmatrix} \begin{pmatrix} x_1\\x_2 \end{pmatrix}=U’x $$<br>$U’$为旋转变换矩阵，它是正交矩阵，即有$U’=U^{-1},U’U^{-1}=I$。<br>旋转变换的目的是为了使得n个样品点在$F_l$轴方向上的离散程度最大，即$F_l$的方差最大。变量$F_l$代表了原始数据的绝大部分信息，在研究某经济问题时，即使不考虑变量$F_2$也无损大局。经过上述旋转变换原始数据的大部分信息集中到$F_l$轴上，对数据中包含的信息起到了浓缩作用。<br>$F_l$， $F_2$除了可以对包含在$X_l$，$ X_2$中的信息起着浓缩作用之外，还具有不相关的性质，这就使得在研究复杂的问题时避免了信息重叠所带来的虚假性。二维平面上的个点的方差大部分都归结在$F_l$轴上，而$F_2$轴上的方差很小。 $F_l$和$F_2$称为原始变量，$x_1$和$x_2$的综合变量。 简化了系统结构，抓住了主要矛盾。<br><strong>多维情形</strong><br>多维变量的情况和二维类似。正如二维椭圆有两个主轴，三维椭球有三个主轴一样，有几个变量，就有几个主轴。和二维情况类似，高维椭球的主轴也是互相垂直的。首先把高维椭球的主轴找出来，再用代表大多数数据信息的最长的几个轴作为新变量。这些互相正交的新变量是原先变量的线性组合，叫做主成分(principal component)。<br>假设我们所讨论的实际问题中，有p个指标，我们把这p个指标看作p个随机变量，记为$X_1， X_2， \cdots，X_p$，主成分分析就是要把这个p指标的问题，转变为讨论p个指标的线性组合的问题，而这些新的指标$F_1， F_2， \cdots， F_k(k\le p)$，按照保留主要信息量的原则充分反映原指标的信息，并且相互独立。<br>这种由讨论多个指标降为少数几个综合指标的过程在数学上就叫做降维。主成分分析通常的做法是，寻求原指标的线性组合Fi。<br>$$ F_1=u_{11}X_1+u_{21}X_2+\cdots+u_{p1}X_p\\F_2=u_{12}X_1+u_{22}X_2+\cdots+u_{p2}X_p\\\cdots\\F_p=u_{1p}X_1+u_{2p}X_2+\cdots+u_{pp}X_p $$<br><strong>满足条件</strong><br>每个主成分的系数平方和为1。即<br>$$ u_{1i}^2+u_{2i}^2+\cdots+u_{pi}^2=1 $$<br>主成分之间相互独立，即无重叠的信息。即<br>$$ Cov(F_i，F_j）=0，i\neq j,i,j=1,2，\cdots，p $$<br>主成分的方差依次递减，重要性依次递减，即<br>$$ Var(F_1)\ge Var(F_2)\ge \cdots \ge Var(F_p) $$</p>
<h3 id="3-主成分的推导"><a href="#3-主成分的推导" class="headerlink" title="3 主成分的推导"></a>3 主成分的推导</h3><p><strong>两个线性代数的结论</strong><br>1、若A是p阶实对称矩阵，则一定可以找到正交阵U，使<br>$$ U^{-1}AU=\begin{bmatrix} \lambda_1 &amp; 0 &amp; \cdots &amp; 0\\0 &amp; \lambda_2 &amp; \cdots &amp; 0\\\vdots &amp; \vdots &amp; \ddots &amp; \vdots\\0 &amp; 0 &amp; \cdots &amp; \lambda_p \end{bmatrix}_{p\times p} $$<br>其中$\lambda_i，i=1,2,\cdots,p $是A的特征根。<br>2、若上述矩阵的特征根所对应的单位特征向量为$u_1,\cdots,u_p$。<br>令<br>$$ U=(u_1,\cdots,u_p)=\begin {bmatrix} u_{11} &amp; u_{12} &amp; \cdots &amp;  u_{1p}\\u_{21} &amp; u_{22} &amp; \cdots &amp; u_{2p}\\\vdots &amp; \vdots &amp; &amp; \vdots\\u_{p1} &amp; u_{p2} &amp; \cdots &amp; u_{pp} \end {bmatrix} $$<br>则实对称阵A属于不同特征根所对应的特征向量是正交的，即有$U’U=UU’=I$<br><strong>第一主成分</strong><br>设X的协方差阵为<br>$$ \Sigma_x=\begin {bmatrix} \sigma_{11} &amp; \sigma_{12} &amp; \cdots &amp; \sigma_{1p}\\\sigma_{21} &amp; \sigma_{22} &amp; \cdots &amp; \sigma_{2p}\\\vdots &amp; \vdots &amp; &amp; \vdots\\\sigma_{p1} &amp; \sigma_{p2} &amp; \cdots &amp; \sigma_{pp} \end {bmatrix} $$<br>由于$\Sigma_x$为非负定的对称阵，必存在正交阵U，使得：<br>$$ U’\Sigma_x U=\begin {bmatrix} \lambda_1 &amp; &amp; 0\\&amp; \ddots  &amp;\\0 &amp; &amp; \lambda_p \end {bmatrix} $$<br>其中$\lambda_1，\lambda_2，\cdots，\lambda_p$为$\Sigma_x$的特征根。不妨假设$\lambda_1\ge \lambda_2\ge \cdots \ge \lambda_p$。而U恰好是由特征根相对应的特征向量所组成的正交阵。<br>$$ U=(u_1,\cdots,u_p)=\begin {bmatrix} u_{11} &amp; u_{12} &amp; \cdots &amp; u_{1p}\\u_{21} &amp; u_{22} &amp; \cdots &amp; u_{2p}\\\vdots &amp; \vdots &amp; &amp; \vdots\\u_{p1} &amp; u_{p2} &amp; \cdots &amp; u_{pp} \end {bmatrix} $$<br>$$ U_i=(u_{1i},u_{2i},\cdots,u_{pi})’ i=1,2,\cdots,p $$<br>设有p维正交向量$a_1=(a_{11},a_{21},\cdots,a_{p1})’$，$F_1=a_{11}X_1+\cdots+a_{p1}X_p=a’X$<br>$$ V(F_1)=a_1’\Sigma a_1==a_1’U\begin {bmatrix} \lambda_1 &amp; &amp; &amp;\\&amp; \lambda_2 &amp; &amp;\\&amp; &amp; \cdots &amp; &amp;\\&amp; &amp; &amp; \lambda_p &amp;\end {bmatrix}U’a_1 $$<br>当且仅当$a_1=u_1$时，即$F_1=u_{11}X_1+\cdots+u_{p1}X_p$时，有最大的方差$\lambda_1$。$Var(F_1)=U_1’\Sigma_x U_1=\lambda_1$。如果第一主成分的信息不够，则需要寻找第二主成分。<br><strong>第二主成分</strong><br>在约束条件$cov(F_1,F_2)=0$下，寻找第二主成分，取线性变换<br>$$ F_2=u_{12}X_1+\cdots+u_{p2}X_p $$<br>的方差次大<br>$$ cov(F_1,F_2)=cov(u_1’x,u_2’x)=u_2’\Sigma u_1=\lambda_1 u_2’u_1=0 $$<br>$$ Var(F_2)=U_2’\Sigma_x U_2=\lambda_2 $$<br>类推<br>$$ F_1=u_{11}X_1+u_{21}X_2+\cdots+u_{p1}X_p\\F_2=u_{12}X_1+u_{22}X_2+\cdots+u_{p2}X_p\\\cdots\\F_p=u_{1p}X_1+u_{2p}X_2+\cdots+u_{pp}X_p$$<br>写成矩阵形式：<br>$$ F=U’X $$<br>$$  U=(u_1,\cdots,u_p)=\begin {bmatrix} u_{11} &amp; u_{12} &amp; \cdots &amp; u_{1p}\\u_{21} &amp; u_{22} &amp; \cdots &amp; u_{2p}\\\vdots &amp; \vdots &amp; &amp; \vdots\\u_{p1} &amp; u_{p2} &amp; \cdots &amp; u_{pp} \end {bmatrix}  $$<br>$$ X=(X_1,X_2,\cdots,X_p)’ $$</p>
<h3 id="4-主成分的性质"><a href="#4-主成分的性质" class="headerlink" title="4 主成分的性质"></a>4 主成分的性质</h3><p>1、<strong>均值</strong> $E(U’x)=U’\mu$<br>2、<strong>方差为所有特征根之和</strong><br>$$ \sum_{i=1}^pVar(F_i)=\lambda_1+\lambda_2+\cdots+\lambda_p=\sigma_1^2+\sigma_2^2+\cdots+\sigma_p^2 $$<br>说明主成分分析把p个随机变量的总方差分解成为p个不相关的随机变量的方差之和。协方差矩阵$\Sigma$的对角线上的元素之和等于特征根之和。<br>3、<strong>精度分析</strong><br>1）贡献率：第i个主成分的方差在全部方差中所占比重$\lambda_i/\sum_{i=1}^p\lambda_i$，称为贡献率，体现这个主成分的综合能力的大小，即反映原来p个指标的信息的多少。<br>2）累积贡献率：前k个主成分共有多大的综合能力，用这个k个主成分的方差和在全部方差中所占比重<br>$$ \sum_{i=1}^k\lambda_i/\sum_{i=1}^p\lambda_i $$<br>来描述，称为累积贡献率。<br>我们进行主成分分析的目的之一是希望用尽可能少的主成分$F_1，F_2，\cdots，F_k(k\le p)$代替原来的p个指标。到底应该选择多少个主成分，在实际工作中，所采用主成分个数的多少取决于能够反映原来变量85%以上的信息量为依据，即当累积贡献率≥85%时的主成分的个数就足够了。最常见的情况是主成分为2到3个。<br>4、<strong>载荷矩阵</strong><br>$$  \begin {bmatrix} u_{11} &amp; u_{12} &amp; \cdots &amp; u_{1m}\\u_{21} &amp; u_{22} &amp; \cdots &amp; u_{2m}\\\vdots &amp; \vdots &amp; &amp; \vdots\\u_{p1} &amp; u_{p2} &amp; \cdots &amp; u_{pm} \end {bmatrix}  $$<br><strong>原始变量与主成分之间的相关系数</strong><br>$$ F_j=u_{1j}x_1+u_{2j}x_2+\cdots+u_{pj}x_p j=1,2,\cdots,m,m\le p $$<br>$$ F=U’X UF=X $$<br>$$ \begin {bmatrix} x_1\\x_2\\\vdots\\x_p \end {bmatrix}=\begin {bmatrix} u_{11} &amp; u_{12} &amp; \cdots &amp; u_{1p}\\u_{21} &amp; u_{22} &amp; \cdots &amp; u_{2p}\\\vdots &amp; \vdots &amp; &amp; \vdots\\u_{p1} &amp; u_{p2} &amp; \cdots &amp; u_{pp} \end {bmatrix}\begin {bmatrix} F_1\\F_2\\\vdots\\F_p \end {bmatrix} $$<br>$$ Cov(x_i,F_j)=Cov(u_{i1}F_1+u_{i2}F_2+\cdots+u_{ip}F_p,F_j)=u_{ij}\lambda_j $$<br>$$ \rho(x_i,F_j)=\frac{u_{ij}\lambda_j}{\sigma_i\sqrt{\lambda_j}}=\frac{u_{ij}\sqrt{\lambda_j}}{\sigma_i} $$<br>可见，$x_i$和$F_j$的相关的密切程度取决于对应线性组合系数的大小。该相关系数又叫因子负荷量。在解释主成分的成因或是第i个变量对第k个主成分的重要性时，应当根据因子负荷量而不是变换系数u.<br><strong>原始变量被主成分的提取率</strong><br>主成分的贡献率和累计贡献率度量了$F_1，F_2，\cdots，F_m$分别从原始变量$X_1, X_2, \cdots, X_P$中提取了多少信息。那么$X_1, X_2, \cdots, X_P$各有多少信息分别被$F_1，F_2，\cdots，F_m$提取？<br>这可以用$F_1，F_2，\cdots，F_m$分别与$X_1, X_2, \cdots, X_P$的相关系数的平方来衡量。<br>$$ Var(x_i)=Var(u_{i1}F_1+u_{i2}F_2+\cdots+u_{ip}F_p) $$<br>则<br>$$ u_{i1}^2\lambda_1+u_{i2}^2\lambda_2+\cdots+u_{im}^2\lambda_m+\cdots+u_{ip}^2\lambda_p=\sigma_i^2 $$<br>$u_{ij}^2\lambda_j$是$F_j$能说明的第i 原始变量的方差。<br>$u_{ij}^2\lambda_j/\sigma_i^2$是$F_j$提取的第i原始变量信息的比重。<br>如果我们仅仅提出了m个主成分，则第i原始变量信息的被提取率为：<br>$$ \Omega_i=\sum_{j=1}^m\lambda_ju_{ij}^2/\sigma_i^2=\sum_{j=1}^m\rho_{ij}^2 $$<br><strong>公共成分</strong><br>定义：如果一个主成分仅仅对某一个原始变量有作用，则称为特殊成分。如果一个主成分对所有的原始变量都起作用，则称为公共成分。</p>
<h3 id="5-主成分分析的步骤"><a href="#5-主成分分析的步骤" class="headerlink" title="5 主成分分析的步骤"></a>5 主成分分析的步骤</h3><p>第一步：由X的协方差阵或相关系数阵Σ，求出其特征根，即解方程，可得特征根。<br>第二步：求出特征根所对应的特征向量$U_1,U_2,\cdots,U_p$，<br>$$ U_i=(u_{1i},u_{2i},\cdots,u_{pi})’ $$<br>第三步：计算累积贡献率，给出恰当的主成分个数。<br>$$ F_i=U_i’X，i=1,2,\cdots,k(k\le p) $$<br>第四步：计算所选出的k个主成分的得分。将原始数据的中心化值:<br>$$ X_i^{\ast}=X_i-\bar X=(x_{1i}-\bar x_1,x_{2i}-\bar x_2,\cdots,x_{pi}-\bar x_p)’ $$<br>代入前k个主成分的表达式，分别计算出各单位k个主成分的得分，并按得分值的大小排队。</p>
<p><strong>基于协方差矩阵</strong></p>
<p>在实际问题中， X的协方差通常是未知的，样品有<br>$$ X_1=(x_{1l},x_{2l},\cdots,x_{pl})’(l=1,2,\cdots,n) $$<br>$$ \hat\Sigma_x=(\frac{1}{n-1}\sum_{l=1}^n(x_{ij}-\bar x_i)(x_{jl}-\bar x_j))_{p\times p} $$</p>
<p><strong>基于相关系数矩阵</strong></p>
<p>如果变量有不同的量纲， 变量水平差异很大，应该基于相关系数矩阵进行主成分分析。不同的是计算得分时应采用标准化后的数据。</p>
<h3 id="6-主成分的应用与回归"><a href="#6-主成分的应用与回归" class="headerlink" title="6 主成分的应用与回归"></a>6 主成分的应用与回归</h3><p>1、主成分分析能降低所研究的数据空间的维数。即用研究m维的Y空间代替p维的X空间(m＜p)，而低维的Y空间代替高维的x空间所损失的信息很少。即使只有一个主成分$Y_1$(即m＝1)时，这个$Y_1$仍是使用全部X变量(p个)得到的。在所选的前m个主成分中，如果某个Xi的系数全部近似于零的话，就可以把这个Xi删除，这也是一种删除多余变量的方法。<br>2、多维数据的一种图形表示方法。多元统计研究的问题大都多于3个变量，要把研究的问题用图形表示出来是不可能的。然而，经过主成分分析后，我们可以选取前两个主成分或其中某两个主成分，根据主成分的得分，画出n个样品在二维平面上的分布情况，由图形可直观地看出各样品在主分量中的地位。<br>3、用主成分分析法构造回归模型。即把各主成分作为新自变量代替原来的自变量做回归分析。<br><strong>主成分回归方法</strong><br>$$ F_1=u_{11}X_1+u_{21}X_2+\cdots+u_{p1}X_p\\F_2=u_{12}X_1+u_{22}X_2+\cdots+u_{p2}X_p\\\cdots\\F_p=u_{1p}X_1+u_{2p}X_2+\cdots+u_{pp}X_p$$</p>
<p>$$ Y_i^{\ast}=\gamma_1F_{11}+\gamma_2F_{12}+\cdots+\gamma_mF_{1m}+\varepsilon_i\\\sum_{i=1}^n[Y_i^{\ast}-\gamma_1F_{11}-\gamma_2F_{12}-\cdots-\gamma_mF_{1m}]^2=min $$</p>
<p>原始数据观测矩阵</p>
<p>$$ X_0=\begin {bmatrix} x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1p}\\x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2p}\\\vdots &amp; \vdots &amp; &amp; \vdots\\x_{n1} &amp; x_{n2} &amp; \cdots &amp; x_{np} \end {bmatrix} $$</p>
<p>主成分系数矩阵</p>
<p>$$  U=(u_1,\cdots,u_p)=\begin {bmatrix} u_{11} &amp; u_{12} &amp; \cdots &amp; u_{1p}\\u_{21} &amp; u_{22} &amp; \cdots &amp; u_{2p}\\\vdots &amp; \vdots &amp; &amp; \vdots\\u_{p1} &amp; u_{p2} &amp; \cdots &amp; u_{pp} \end {bmatrix}  $$</p>
<p>主成分得分矩阵</p>
<p>$$ \begin {bmatrix} F_{11} &amp; F_{12} &amp; \cdots &amp; F_{1p}\\F_{21} &amp; F_{22} &amp; \cdots &amp; F_{2p}\\\vdots &amp; \vdots &amp; &amp; \vdots\\F_{n1} &amp; F_{n2} &amp; \cdots &amp; F_{np} \end {bmatrix}\\F=X_0U $$</p>
<p><strong>主成分分析的一些注意事项</strong><br>主成分分析依赖于原始变量，也只能反映原始变量的信息。所以原始变量的选择很重要。<br>如果原始变量本质上独立，那么降维就可能失败，这是因为很难把很多独立变量用少数综合的变量概括。数据越相关，降维效果就越好。<br>分析结果并不一定会有清楚的解释。这与问题的性质，选取的原始变量以及数据的质量等都有关系。<br><strong>基于相关系数矩阵还是基于协方差矩阵做主成分分析？</strong><br>有时基于相关系数矩阵和基于协方差矩阵求出的主成分会有很大不同，且两者之间不存在简单的线性关系。<br>一般而言，当分析中所选择的经济变量具有不同的量纲，变量水平差异很大，应考虑将数据标准化，选择基于相关系数矩阵的主成分分析。对同度量或是取值范围在同量级的数据，选择基于协方差矩阵的主成分分析。<br><strong>选择几个主成分？</strong><br>主成分分析的目的是简化变量，一般情况下主成分的个数应该小于原始变量的个数。关于保留几个主成分，应该权衡主成分个数和保留的信息。<br><strong>如何解释主成分所包含的经济意义？</strong><br>主成分分析不要求数据来自于正态总体。一般认为当原始数据大部分变量的相关系数都小于0.3时，运用主成分分析的效果不显著。</p>
<h3 id="7-主成分分析的r语言实现"><a href="#7-主成分分析的R语言实现" class="headerlink" title="7 主成分分析的R语言实现"></a>7 主成分分析的R语言实现</h3><p>主成分分析的函数本篇介绍的主要有两个。<br>一个是princomp，一个是psych里的principal。</p>
<pre><code>princomp(x,cor=FALSE,scores=TRUE)
</code></pre><p>x为主成分分析数据集，cor=TRUE和FALSE分别代表是基于相关系数矩阵计算还是协方差矩阵计算。scores则代表是否存储主成分得分。</p>
<pre><code>principal(x,nfactors=2,rotate=&quot;varimax&quot;,scores=T,covar=F)
</code></pre><p>x为主成分分析数据集，nfactors为主成分个数，rotate表示旋转方式（一般选方差最大，保证互不相关），scores则代表是否存储主成分得分，covar=TRUE和FALSE分别代表是基于协方差矩阵计算还是相关系数矩阵计算。<br>这回用的数据是2006年城市统计年鉴285个地级市的经济人口数据，探究gdp与人口之间的关系。<br>先做一个相关系数可视化。发现人口因子之间相互影响因子很高。</p>
<p><img src="http://img.blog.csdn.net/20170922113957661?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>于是先对人口的几个因子进行降维和主成分分析，中途发现第三产业从业人数（third)加入会使得系数矩阵不正定，后面就删除了第三产业从业人数(third)。<br>分别用不同方式进行主成分分析结果。<br>princomp结果（基于协方差矩阵）<br>碎石图</p>
<p><img src="http://img.blog.csdn.net/20170922114350110?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br>结果</p>
<p><img src="http://img.blog.csdn.net/20170922114628759?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>主成分得分图</p>
<p><img src="http://img.blog.csdn.net/20170922114914511?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br>princomp结果（基于相关系数矩阵）<br>碎石图</p>
<p><img src="http://img.blog.csdn.net/20170922114947287?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""><br>结果</p>
<p><img src="http://img.blog.csdn.net/20170922115017165?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>主成分得分图</p>
<p><img src="http://img.blog.csdn.net/20170922115034650?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>principal结果<br>碎石图</p>
<p><img src="http://img.blog.csdn.net/20170922115104036?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>因子关系图<br><img src="http://img.blog.csdn.net/20170922115130649?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>主成分得分图</p>
<p><img src="http://img.blog.csdn.net/20170922115210591?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>碎石图表示的是曲线与纵坐标1交点的横坐标即为主成分个数，而主成分得分荷图是将原始数据的坐标映射在主成分分析的坐标上，事实上可以根据主成分得分在不同象限对原始数据进行分类，在本篇的样例数据里其实就是可以通过人口生成的几个主成分对中国地级市进行分类，可以区分出是在第一主成分得分高，第二主成分得分低的城市，亦或是其他排列组合的分类结果。关于这种可视化图具体如何解释。可以参照如下的文章。</p>
<blockquote>
<p><a href="http://www.cnblogs.com/SCUJIN/p/5965946.html" target="_blank" rel="external">http://www.cnblogs.com/SCUJIN/p/5965946.html</a></p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/11/应用统计学与R语言实现学习笔记（十一）——判别分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Dai Shaoqing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="GISerDaiShaoqing's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/11/应用统计学与R语言实现学习笔记（十一）——判别分析/" itemprop="url">
                  应用统计学与R语言实现学习笔记（十一）——判别分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-11T00:00:00+08:00">
                2017-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/统计与模型/" itemprop="url" rel="index">
                    <span itemprop="name">统计与模型</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/09/11/应用统计学与R语言实现学习笔记（十一）——判别分析/" class="leancloud_visitors" data-flag-title="应用统计学与R语言实现学习笔记（十一）——判别分析">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="chapter-11-discriminant-analysis"><a href="#Chapter-11-Discriminant-Analysis" class="headerlink" title="Chapter 11 Discriminant Analysis"></a>Chapter 11 Discriminant Analysis</h1><p>笔者最近任务繁重，断更了一顿时间，最近会开始慢慢把这个系列写完。本篇是第十一章，内容是判别分析。</p>
<h3 id="1-判别分析应用"><a href="#1-判别分析应用" class="headerlink" title="1 判别分析应用"></a>1 判别分析应用</h3><p>判别分析（Discriminant Analysis）——判别分析的目的是对已知分类的数据建立由数值指标构成的分类规则，然后把这样的规则应用到未知分类的样本中去分类，以识别未知样本所属的类别。判别分析是多元数据分析的重要方法之一。通常解决被解释变量是非数值变量，解释变量是数值变量的情形。<br>事实上地学领域应用判别分析最多的是在哪里呢？其实是遥感影像的地物分类，通常遥感导论中无论Erdas或者ENVI在做完监督分类之后，其实就是用标注的样本去训练判别函数，然后用判别函数完成整幅影像的判别分析，就可以分出不同的地物类型，这种方法就是我们最普遍使用的极大似然法。而这里的被解释变量就是地物类型，解释变量（多元）就是遥感影像不同波段的DN值，或者是辐射率。</p>
<blockquote>
<ul>
<li>聚类分析和判别分析差异<br>在聚类分析中，人们一般事先并不知道应该分成几类及哪几类，全根据数据确定。<br>在判别分析中，至少有一个已经明确知道类别的“训练样本”，并利用该样本来建立判别准则，并通过预测变量来为未知类别的观测值进行判别。<br>通常实际问题中，可以先聚类以得知类型,再进行判别。<br><strong>用机器学习的话来说，聚类分析是非监督学习，判别分析属于监督学习。</strong></li>
</ul>
</blockquote>
<p>判别分析的数据结构</p>
<table>
<thead>
<tr>
<th>individuals</th>
<th style="text-align:center">$X_1$</th>
<th style="text-align:center">$X_2$</th>
<th style="text-align:center">$\cdots$</th>
<th style="text-align:right">$X_l$</th>
<th style="text-align:right">$\dots$</th>
<th>$X_p$</th>
<th><strong>Y</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td style="text-align:center">28</td>
<td style="text-align:center">1.0</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:right">114</td>
<td style="text-align:right">$\cdots$</td>
<td>0.15</td>
<td><strong>1</strong></td>
</tr>
<tr>
<td>2</td>
<td style="text-align:center">29</td>
<td style="text-align:center">2.0</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:right">117</td>
<td style="text-align:right">$\cdots$</td>
<td>0.20</td>
<td><strong>1</strong></td>
</tr>
<tr>
<td>$\cdots$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:right">$\cdots$</td>
<td style="text-align:right">$\cdots$</td>
<td>$\cdots$</td>
<td>$\cdots$</td>
</tr>
<tr>
<td>i</td>
<td style="text-align:center">$x_{i1}$</td>
<td style="text-align:center">$x_{i2}$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:right">$x_{il}$</td>
<td style="text-align:right">$\cdots$</td>
<td>$x_{ip}$</td>
<td><strong>2</strong></td>
</tr>
<tr>
<td>$\cdots$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:right">$\cdots$</td>
<td style="text-align:right">$\cdots$</td>
<td>$\cdots$</td>
<td>$\cdots$</td>
</tr>
<tr>
<td>47</td>
<td style="text-align:center">15</td>
<td style="text-align:center">8</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:right">64</td>
<td style="text-align:right">$\cdots$</td>
<td>0.51</td>
<td><strong>2</strong></td>
</tr>
<tr>
<td>48</td>
<td style="text-align:center">16</td>
<td style="text-align:center">7.5</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:right">65</td>
<td style="text-align:right">$\cdots$</td>
<td>0.50</td>
<td><strong>3</strong></td>
</tr>
<tr>
<td>$\cdots$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:right">$\cdots$</td>
<td style="text-align:right">$\cdots$</td>
<td>$\cdots$</td>
<td>$\cdots$</td>
</tr>
<tr>
<td>n</td>
<td style="text-align:center">$x_{n1}$</td>
<td style="text-align:center">$x_{n2}$</td>
<td style="text-align:center">$\cdots$</td>
<td style="text-align:right">$x_{nl}$</td>
<td style="text-align:right">$\cdots$</td>
<td>$x_{np}$</td>
<td><strong>3</strong></td>
</tr>
</tbody>
</table>
<p>对比聚类分析的数据结构，事实上就是多了最后一列的Y。</p>
<blockquote>
<ul>
<li>个体由$X_1,X_2,\cdots,X_p$变量描述。</li>
<li>有分类变量$Y$明确对个体分类。</li>
<li>问题：建立$Y与X_1,X_2,\cdots,X_p$变量间关系的函数。根据函数将新个体进行分类。</li>
</ul>
</blockquote>
<p><strong>误判率</strong><br>误判率的高低有下面两个因素决定：</p>
<blockquote>
<ul>
<li>主观因素：分界线的位置要正确。</li>
<li>客观因素：均值，方差——通过选择指标来控制：一般来说，维度高一点，可以使分辨率高一些，但在许多情况下，指标太多，不仅不能提高分辨率，还增加计算量（需要丰富的实际经验和试算）；在做判别分析前，要做假设检验。在两个总体的均值有显著差异的情况下，再做判别分析。</li>
</ul>
</blockquote>
<p><strong>判别分析的假设</strong></p>
<blockquote>
<ul>
<li>每一个判别变量（解释变量）不能是其他判别变量的线性组合——不符合该假设的话，无法估计判别函数，变量间高度相关或一变量与其他变量的线性组合高度相关时，参数估计的标准误差将很大。</li>
<li>判别变量之间具有多元正态分布——可精确的计算显著性检验值和归属概率。</li>
<li>如要采用线性判别函数，还要求各组协方差距阵相等——线性判别函数使用起来最方便、在实际中使用最广。</li>
</ul>
</blockquote>
<h3 id="2-判别分析方法"><a href="#2-判别分析方法" class="headerlink" title="2 判别分析方法"></a>2 判别分析方法</h3><h4 id="21-距离判别法"><a href="#2-1-距离判别法" class="headerlink" title="2.1 距离判别法"></a>2.1 距离判别法</h4><p><strong>两总体情况</strong><br>假设有两个总体$G_1$和$G_2$，如果能够定义点x到它们的距离d(x,$G_1$)和d(x,$G_2$)，则可用如下规则进行判别：</p>
<blockquote>
<ul>
<li>如果d(x,$G_1$) &lt; d(x,$G_2$)则$x\in G_1$</li>
<li>如果d(x,$G_2$) &lt; d(x,$G_1$)则$x\in G_2$</li>
<li>如果d(x,$G_1$) = d(x,$G_2$)则待判。</li>
</ul>
</blockquote>
<p>距离常选用马氏距离——假设$\mu_1,\mu_2,\Sigma_1,\Sigma_2$分别为$G_1和G_2$的均值向量和协方差阵，则点$x$到$G_i$的马氏距离为<br>$$ d^2(x,G_i)=(x-μ_i)’(\Sigma_i)^{-1}(x-μ_i) $$<br>马氏距离的好处是可以克服变量之间的相关性干扰，并且消除各变量量纲的影响。</p>
<blockquote>
<ul>
<li>$\Sigma_1=\Sigma_2=\Sigma$<br>定义：<br>$$ \begin{aligned}<br>d^2(x,G_1)-d^2(x,G_2) &amp; =(x-\mu_1)’\Sigma^{-1}(x-\mu_1)-(x-\mu_2)’\Sigma^{-1}(x-\mu_2) \ &amp;=-2[x-(\mu_1+\mu_2)/2]’\Sigma^{-1}(\mu_1-\mu_2) \end{aligned} $$<br>令：$ \bar\mu=(\mu_1+\mu_2)/2, \alpha=\Sigma^{-1}(\mu_1-\mu_2),W(x)=(x-\bar\mu)’\alpha=\alpha’(x-\bar\mu) $<br>判别规则：<br>如果W(x)&gt;0，d(x,$G_1$) &lt; d(x,$G_2$)则$x\in G_1$<br>如果W(x)<0，d(x,$g_,1$)> d(x,$G_2$)则$x\in G_2$<br>如果W(x)=0，d(x,$G_1$) = d(x,$G_2$)则待判。<br>称W(x)为判别函数(discriminant function)，α为判别系数。<br>当$\mu_1,\mu_2,\Sigma$未知时，可通过样本来估计。<br>$ x_1^{(i)},\cdots,x_{n_i}^{(i)} $为来自$G_i$的样本(i=1,2)。<br>$$ \hat\mu^{(i)}=\frac{1}{n_i}\sum_{k=1}^{n_2}x_k^{(i)}=\bar x^{(i)},\hat \Sigma=\frac{1}{n_1+n_2-2}(S_1+S_2), $$<br>$$ S_i=\sum_{t=1}^{n_i}(x_t^{(i)}-\bar x^{(i)})(x_t^{(i)}-\bar x^{(i)})’,\bar x=\frac{1}{2}(\bar x^{(1)}+\bar x^{(2)}) $$<br>判别函数为$W(x)=(x-\bar x)’\Sigma^{-1}(\bar x^{(1)}-\bar x^{(2)})$</0，d(x,$g_,1$)></li>
<li>$\Sigma_1 \neq \Sigma_2$<br>判别函数为二次函数<br>$W(x)=d^2(x,G_2)-d^2(x,G_1)=(x-\mu_2)’\Sigma_2^{-1}(x-\mu_2)-(x-\mu_1)’\Sigma_2^{-1}(x-\mu_1)$<br>按照距离最近原则，判别准则为：<br>如果W(x)&gt;0即d(x,$G_1$) &lt; d(x,$G_2$)则$x\in G_1$<br>如果W(x)<0即d(x,$g_,1$)> d(x,$G_2$)则$x\in G_2$<br>如果W(x)=0即d(x,$G_1$) = d(x,$G_2$)则待判。</0即d(x,$g_,1$)></li>
</ul>
</blockquote>
<p><strong>多总体情况</strong></p>
<blockquote>
<ul>
<li>多总体情况：协方差相同<br>假设有k个总体$G_1,G_2,\cdots,G_k$，它们的均值向量分别为$\mu_1,\mu_2,\cdots,\mu_k$,协方差阵为$\Sigma$，类似于两总体的讨论，判别函数为：<br>$W_{ij}(x)=[x-(\mu_1+\mu_2)/2]’\Sigma^{-1}(\mu_i-\mu_j),i,j=1,\cdots,k$<br>判别规则：<br>如果存在i，对所有j≠i，有$W_{ij}(x)&gt;0$，则$x\in G_i$，否则待判。<br>如果服从多元正态分布，且各组协方差相同<br>$\begin{aligned} d^2(x,G_i)&amp; =(x-\mu_i)’\Sigma^{-1}(x-\mu_i) \ &amp; =x’\Sigma^{-1}x-2(x’\Sigma^{-1}\mu_i-\mu_i’\Sigma^{-1}\mu_i/2) \ &amp; =x’\Sigma^{-1}x-f_i(x)\end{aligned}$<br>在所有的$f_i(x)$中，哪个$f_i(x)$的值大，x到相应的组i的马氏距离小，判$x\in G_i$</li>
<li>多总体情况：协方差不等<br>假设有k个总体$G_1,G_2,\cdots,G_k$，它们的均值向量分别为$\mu_1,\mu_2,\cdots,\mu_k$,协方差阵为$\Sigma_1,\Sigma_2,\cdots,\Sigma_k$，类似于两总体的讨论，判别函数为：<br>$W(x)=(x-\mu_j)’\Sigma_j^{-1}(x-\mu_j)-(x-\mu_i)’\Sigma_i^{-1}(x-\mu_i),i,j=1,\cdots,k$<br>判别规则：<br>如果存在i，对所有j≠i，有$W_{ij}(x)&gt;0$，则$x\in G_i$，否则待判。<br>如果总体均值、协方差未知，用样本均值、协方差估计。</li>
<li>若总体不服从正态分布，直接从马氏距离来做判别分析，失去了概率意义，仅仅是一直观的经验判断而已，可能偏误较大。</li>
</ul>
</blockquote>
<h4 id="22-fisher判别法"><a href="#2-2-Fisher判别法" class="headerlink" title="2.2 Fisher判别法"></a>2.2 Fisher判别法</h4><p>Fisher判别法的思想就是投影，将k组p维数据投影到某一个方向，使得它们的投影组与组之间尽可能的分开。考虑只有两个(预测)变量的判别问题。假定只有两类。数据中的每个观测值是二维空间的一个点。这里只有两种已知类型的训练样本。一 类 有 38 个 点 ( 用“o”表示)，另一类有44个点(用“*”表示)。按原来变量(横坐标和纵坐标)，很难将这两种点分开。</p>
<p><img src="http://img.blog.csdn.net/20170909171703184?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>但是沿着图上的虚线方向朝和这个虚线垂直的一条直线进行投影会使得这两类分得最清楚。可以看出，如果向其他方向投影，判别效果不会比这个好。有了投影之后，再用前面讲到的距离远近的方法得到判别准则。这种先投影的判别方法就是Fisher判别法。<br>Fisher判别法</p>
<blockquote>
<ul>
<li>不要求总体分布类型；</li>
<li>工作原理就是对原数据系统进行坐标变换，寻求能够将总体尽可能分开的方向；</li>
<li>a为$R^p$中的任一向量，点x在以a为法方向的投影为a’x;</li>
<li>各组数据的投影为：<br>$$ G_i:a’x_1^{(i)}\cdots a’x_n^{(i)},i=1,2,\cdots,k$$</li>
<li>这些数据正好组成一元方差分析的数据。</li>
</ul>
</blockquote>
<p>将$G_m$组中数据投影的均值记为$ a’\bar x^{(m)} $,有：<br>$$ a’\bar x^{(m)}=\frac{1}{n_m}\sum_{i=1}^{n_m}a’\bar x_i^{(m)} ,m=1,\cdots,k$$<br>记k组数据投影的总均值为$a’\bar x$，有：<br>$$ a’\bar x=\frac{1}{n}\sum_{m=1}^{k}\sum_{i=1}^{n_m}a’\bar x_i^{(m)} $$<br>组间离差平方和为：<br>$$ SSG=\sum_{m=1}^{k}n_m(a’\bar x^{(m)}-a’\bar x)^2=a’[\sum_{m=1}^{k}n_m(\bar x^{(m)}-\bar x)(\bar x^{(m)}-\bar x)’]a=a’Ba; $$<br>$$  B=\sum_{m=1}^{k}n_m[(\bar x^{(m)}-\bar x)(\bar x^{(m)}-\bar x)’]  $$<br>组内离差平方和为：<br>$$ SSE=\sum_{m=1}^k \sum_{i=1}^{n_m}(a’\bar x^{(m)}-a’\bar x)^2=a’[\sum_{m=1}^k \sum_{i=1}^{n_m}(\bar x^{(m)}-\bar x)(\bar x^{(m)}-\bar x)’]a=a’Ea $$<br>$$ E=\sum_{m=1}^k \sum_{i=1}^{n_m}(\bar x^{(m)}-\bar x)(\bar x^{(m)}-\bar x)’ $$<br>如果K组有显著差异，则<br>$$ F=\frac{SSG/(k-1)}{SSE/(n-k)}=\frac{n-k}{k-1}\frac{a’Ba}{a’Ea} $$<br>F应充分大，即希望找到a使得SSG尽可能大而SSE尽可能小。<br>$$ \Delta (a)=\frac{a’Ba}{a’Ea}\rightarrow max $$<br>使$\frac{a’Ba}{a’Ea}$最大的值为方程$\left|B-\lambda E\right|=0$的最大特征根$\lambda_1$。记方程$\left|B-\lambda E\right|=0$的全部特征根为$\lambda_1\ge \cdots \ge \lambda_r \gt 0$，相应的特征向量为$v_1,\cdots,v_r$。$\Delta (a)$的大小可以估计判别函数$y_i (x)=v_i’x(=a’x)$的效果。记$p_i$为判别能力（效率），有：<br>$$ p_i=\frac{\lambda_i}{\sum_{h=1}^r \lambda_h} $$<br>在有些问题中，仅用一个线性判别函数不能很好区别各个总体，可取第二个、第三个，以此类推。 m个判别函数的判别能力定义为：<br>$$ \sum_{i=1}^mp_i=\frac{\sum_{i=1}^m\lambda_i}{\sum_{h=1}^r \lambda_h} $$<br>据此来确定选择多少判别函数。<br><strong>判别准则</strong><br>选择i使得：<br>$$ v_1’(x-\mu_i)+\cdots+v_m’(x-\mu_i) $$<br>的值最小<br><strong>Fisher判别法实质</strong></p>
<blockquote>
<ul>
<li>选几个新的综合性指标，代替原来的p个指标。</li>
<li>构成新的综合性指标的条件：<br>（1）不同类的均值差距尽可能大；<br>（2）各类中的方差尽可能小。</li>
</ul>
</blockquote>
<p>Fisher判别法的依据不是x属于哪个总体的概率的大小，而是类别之间具有最大的可分性，也没有考虑错判带来的损失大小（错报台风登陆vs.漏报台风登陆）。</p>
<h4 id="23-bayes判别法"><a href="#2-3-Bayes判别法" class="headerlink" title="2.3 Bayes判别法"></a>2.3 Bayes判别法</h4><blockquote>
<ul>
<li>不用判别式，而是比较新给样品属于各个总体的条件概率p(g|x)，$g=1,\cdots,k$的大小，将新样品判归为来自条件概率最大的总体。</li>
<li>先给出 k 个总体的先验概率$q_1,\cdots,q_k$（实践中通常把频率作为先验概率）。如各总体密度为${f_k(x)}$，则后验概率为($g=1,\cdots,k$):$P(g|x)=q_gf_g(x)/\Sigma_i q_if_i(x)$。</li>
<li>当且仅当$P(h|x)= max_gP(g|x)$，判x来自第h总体。</li>
<li>也可以用使错判的损失最小的准则来判别。</li>
<li>设($D_1,D_2,\cdots,D_K$)是$R_p$的一个完备的划分，当样品x属于$D_i$,就判x来自$G_i$。</li>
<li>记$p(j|i), c(j|i)$分别为来自i总体的个体被错判到第j总体的概率和损失。定义平均错判损失(ECM: expected cost of misclassification)为$ECM(D)=\Sigma_{i=1\cdots k}q_i[\Sigma_{j=1\cdots k}p(j|i)c(j|i)]$</li>
<li>Bayes判别法就是要选择划分D使得ECM(D)最小。</li>
</ul>
</blockquote>
<h3 id="3-建立判别函数的方法"><a href="#3-建立判别函数的方法" class="headerlink" title="3 建立判别函数的方法"></a>3 建立判别函数的方法</h3><p>与多元回归类似，变量选择的好坏直接影响判别分析的效果。<br>常遇问题：（1）忽略最主要的指标；（2）引入太多指标，计算量既大又干扰分析。</p>
<blockquote>
<ul>
<li>全模型法(SPSS系统默认方法）</li>
<li>前向选择法<br>从没有变量的模型开始 每一部逐步把对判别函数贡献最大的变量加入模型，直到模型外没有一个变量<br>符合条件为止。当希望有较多变量进入判别函数时，选用此方法（在Syntax中实现）。选择使威尔克斯统计量最小且显著的变量加入。</li>
<li>后向选择法<br>从包含用户指定的所有变量的模型开始。每一部逐步把对判别函数贡献最小的变量从模型中剔除出去，直到留在模型中的变量都符合条件为止。当希望判别函数含有较少变量时，选用此方法。选择使威尔克斯统计量最大且不显著的变量剔除。</li>
<li>逐步选择法<br>前向选择和后向选择的结合。从没有变量的模型开始。每一部逐步把对判别函数贡献最大的变量加入模型，同时，对模型中的变量进行检验，把不符合条件的变量从模型中删除。是一种较好的方法。选择使威尔克斯统计量最小且显著的变量加入。选择使威尔克斯统计量最大且不显著的变量剔除。</li>
</ul>
</blockquote>
<h3 id="4-判别分析的步骤及注意事项"><a href="#4-判别分析的步骤及注意事项" class="headerlink" title="4 判别分析的步骤及注意事项"></a>4 判别分析的步骤及注意事项</h3><p><strong>判别分析的步骤</strong></p>
<blockquote>
<ul>
<li>第1步：确定研究的问题与目的<br>判别分析适合将个体归类的问题，特别适合一个定性的被解释变量和多个定量的解释变量的情形。</li>
<li>第2步：判别分析研究设计<br>解释变量与被解释变量的选择：被解释变量的组数可以是两个或更多，但必须互斥和完备。<br>样本容量：判别分析对样本量与预测变量的比率敏感。<br>总样本量：建议比率为每个解释变量20个观测，最小的总样本量为每个变量5个观测。最小的组的大小必须超过解释变量的个数，建议每组至少有20个观测，还要注意组的相对大小（大的组有不相称的高的分类机会）。<br>样本分割：需要将样本分割为两个子样本，一个用于估计判别函数，另一个用于验证。随机分组，最常见的是随机分为两半。通常各组比率相同。</li>
<li>第3步：判别分析的假定<br>多元正态性，如不满足建议使用Logistic回归。Box’s Test 检验各组协方差阵是否相等，不等的协方差矩阵可能会负面影响分类过程，观测会被“过度归类”到大的协方差阵组中。解释变量的多重共线性。</li>
<li>第4步：估计判别模型和评估整体拟和统计显著性： Wilks’ Lambda， Hotelling迹和Pillai评估判别函数的判别效力的显著性。<br>评估整体拟和：计算每个观测的判别Z得分，检验各组在判别Z得分上的差异，评估组，关系的预测精度。</li>
<li>第5步：结果的解释<br>解释判别分析中每个解释变量的相对重要性。<br>标准化判别权重（判别系数）：如存在多重共线性时不合适，可能不稳定。<br>判别载荷，又称结构相关系数，是每个解释变量与判别函数的简单相关系数，也可能不稳定。<br>偏F值。<br>能力指数：当保留多个判别函数时。</li>
<li>第6步：结果的验证<br>分隔样本或交叉验证法。</li>
</ul>
</blockquote>
<p><strong>判别分析注意事项</strong></p>
<blockquote>
<ul>
<li>解释变量（判别变量）必须是可测量的。</li>
<li>每一个判别变量不能是其它判别变量的线性组合（不能提供新的信息，无法估计判别函数）。</li>
<li>判别变量不能高度相关，否则导致估计的标准误差很大。</li>
<li>训练样本中必须包含所有要判别的类型，分类必须清楚（在判别分析前最好应当做假设检验，确定各个类的有关变量的均值是显著不同的）。</li>
<li>要选择好可能用于判别的预测变量。判别分析是为了正确地分类，但同时也要注意使用尽可能少的预测变量来达到这个目的。使用较少的变量意味着节省资源和易于对结果作解释。</li>
<li>检验结果(在SPSS选项中选择Wilks’ Lambda、Rao’s V、 The Squared Mahalanobis Distance或The Sum of Unexplained Variations等检验的计算机输出)，以确定是否分类结果仅由于随机因素。</li>
<li>对于多个判别函数，要弄清各自的重要性。</li>
<li>注意训练样本的正确和错误分类率。研究被误分类的观测值，看是否能找出原因。</li>
</ul>
</blockquote>
<h3 id="5-r语言中判别分析实现"><a href="#5-R语言中判别分析实现" class="headerlink" title="5 R语言中判别分析实现"></a>5 R语言中判别分析实现</h3><p>正如上文提到的，我们以一个简单的地物分类的例子来进行实践。<br>原始的遥感影像如图所示(高分一号卫星16 m数据）。</p>
<p><img src="http://img.blog.csdn.net/20170911211711221?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>高分一号卫星有四个波段，分别显示如下：</p>
<p><img src="http://img.blog.csdn.net/20170911211731915?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>我们随机在区域内生成了55个样本点，并根据目视解译做了分类，由于所处研究区位于新城且仅作测试，用地类型仅选择了两类：建设用地/不透水面和植被。前面已经用4，3，2显示了原始影像，红色部分即为植被。植被为类型1，建设用地/不透水面为类型2。</p>
<p><img src="http://img.blog.csdn.net/20170911171703788?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>另外我们随机在区域内还生成了10个样本点作为验证点。</p>
<p><img src="http://img.blog.csdn.net/20170911172010416?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>接着下来我们读取数据并且利用三种不同的判别分析方法进行判别分析地物类别。<br>判别分析可以自己通过dist函数计算距离得到。现在已经有对应的包可以直接分析。<br>这里推荐两个包（WMDB和MASS）。<br>WMDB可以实现加权马氏距离判别分析和Bayes判别分析，MASS可以实现Fisher判别分析。<br>距离判别分析的函数为wmd。具体参数如下：</p>
<pre><code>wmd(Trnx,TrnG,Tweight=NULL,Tstx=NULL,var.equal=F)
</code></pre><p>Trnx是训练样本数据。TrnG为分类结果，Tweight为指定权重，可以根据主成分贡献计算或者取相等（原始的判别分析法），Tstx为待测样本数据，var.equal指定协方差矩阵是否相等。<br>Fisher判别分析的函数为lda。具体参数如下：</p>
<pre><code>lda(formula,data,……,subset,na.action)
</code></pre><p>formula形如groups~x1+x2+……的形式，data为数据集，subset指定训练样本，na.action指定有缺失值处理方式。<br>Bayes判别分析的函数为dbayes。具体参数如下：</p>
<pre><code>dbayes(Trnx,TrnG,p=rep(1,length(levels(TrnG))),Tstx=NULL,var.equal=F)
</code></pre><p>Trnx是训练样本数据。TrnG为分类结果，p为指定先验概率的向量，Tstx为待测样本数据，var.equal指定协方差矩阵是否相等。<br>接下来就是基于高分影像的四个波段进行训练和判别分析。<br>距离判别分析结果。</p>
<p><img src="http://img.blog.csdn.net/20170911203632627?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>Fisher判别分析结果。</p>
<p><img src="http://img.blog.csdn.net/20170911203707436?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>列联表分析及判别准确率。</p>
<p><img src="http://img.blog.csdn.net/20170911203729717?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p><img src="http://img.blog.csdn.net/20170911203748500?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>Bayes判别分析结果。</p>
<p><img src="http://img.blog.csdn.net/20170911203815468?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>从样本数据来看，Fisher结果是最好的。<br>接下来即按照训练好的判别规则进行分类。这里发现WMDB包的两个函数并没有提供预测功能，这里选用了另一个包klaR来做贝叶斯分类（朴素贝叶斯）。<br>分类结果对比：</p>
<p><img src="http://img.blog.csdn.net/20170911211753018?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>为了验证准确率，这里利用随机生成的10个验证点进行精度验证。</p>
<p><img src="http://img.blog.csdn.net/20170911211141222?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvRVNBX0RTUQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>由于选取验证点较少，准确率都达到了100%。从实际影像对比来看，似乎Bayes方法将更多细小的植被提取出来了，但是也有一部分道路错分。Fisher方法少提取了一部分，但错分的部分几乎没有。<br>这部分的代码和数据后面会一起放出来。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Dai Shaoqing" />
          <p class="site-author-name" itemprop="name">Dai Shaoqing</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">31</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/GISerDaiShaoqing" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2884386252/profile?rightmod=1&wvr=6&mod=personinfo" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.researchgate.net/profile/Shaoqing_Dai" title="Research Gate" target="_blank">Research Gate</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://112.74.203.220:8081/chs/index.php" title="Research Group" target="_blank">Research Group</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.sciencenet.cn/u/GISdsq" title="ScienceNet" target="_blank">ScienceNet</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dai Shaoqing</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






    
    
    
    
    <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
    <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
    
        <script type="text/javascript">
            var gitment = new Gitment({
                id: document.location.href, 
                owner: 'GISerDaiShaoqing',
                repo: 'GISerDaiShaoqing.github.io',
                oauth: {
                    client_id: '52927536ee23a4cd8688',
                    client_secret: '6b7134d12cd38cc11a50542fb23b5dee864b907d',
                }});
            gitment.render('gitment-container');
        </script>
    
 
  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("oTblBOq0hbTxjxkvF4aCAjQ6-gzGzoHsz", "5R3loDlmeKFd1bdvCNnq065n");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

</body>
</html>
